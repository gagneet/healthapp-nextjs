// ==============================================================
// COMPLETE HEALTHCARE PLATFORM PRISMA SCHEMA
// ==============================================================
// This schema includes all models for:
// - Common/Shared features (Users, Notifications, Messages, Audit)
// - Doctor module (Prescriptions, Consultations, Clinical Decision Support)
// - HSP module (Treatment Plans, Home Visits, Wound Care, AYUSH)
// - Patient module (Adherence tracking, Vitals, Goals)
// - India-specific (ABDM, AYUSH treatments, Multi-language)
//
// Run: npx prisma migrate dev --name complete_healthcare_platform
// ==============================================================

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum UserRole {
    SYSTEM_ADMIN
    HOSPITAL_ADMIN
    DOCTOR
    HSP
    PATIENT
    CAREGIVER
    ADMIN
    PROVIDER_ADMIN
}

enum UserStatus {
    ACTIVE
    INACTIVE
    SUSPENDED
    PENDING_VERIFICATION
}

enum Gender {
    MALE
    FEMALE
    OTHER
    PREFER_NOT_TO_SAY
}

enum ConsentStatus {
    PENDING
    GRANTED
    DENIED
    REVOKED
    EXPIRED
}

enum NotificationType {
    MEDICATION_REMINDER
    MEDICATION_MISSED
    MEDICATION_REFILL_DUE
    MEDICATION_INTERACTION_ALERT
    REFILL_APPROVED
    REFILL_DENIED
    APPOINTMENT_REMINDER
    APPOINTMENT_CONFIRMED
    APPOINTMENT_CANCELLED
    APPOINTMENT_RESCHEDULED
    VIDEO_CALL_STARTING
    VITAL_REMINDER
    VITAL_ABNORMAL
    VITAL_CRITICAL
    CARE_PLAN_UPDATED
    TREATMENT_PLAN_UPDATED
    NEW_PRESCRIPTION
    LAB_RESULTS_READY
    LAB_RESULTS_ABNORMAL
    SYSTEM_ANNOUNCEMENT
    DOCUMENT_SHARED
    MESSAGE_RECEIVED
    EMERGENCY_ALERT
    CAREGIVER_ALERT
    ACHIEVEMENT_UNLOCKED
    STREAK_MILESTONE
    CHALLENGE_COMPLETED
}

enum NotificationCategory {
    CLINICAL
    ADMINISTRATIVE
    REMINDER
    ALERT
    SYSTEM
    SOCIAL
}

enum NotificationPriority {
    LOW
    MEDIUM
    HIGH
    CRITICAL
}

enum NotificationChannel {
    PUSH
    EMAIL
    SMS
    WHATSAPP
    IN_APP
}

enum AuditAction {
    CREATE
    READ
    UPDATE
    DELETE
    LOGIN
    LOGOUT
    EXPORT
    SHARE
    CONSENT_GRANTED
    CONSENT_REVOKED
    PRESCRIPTION_CREATED
    PRESCRIPTION_DISPENSED
    VITAL_RECORDED
    ALERT_TRIGGERED
    EMERGENCY_ACCESSED
}

enum ProviderType {
    DOCTOR
    HSP
}

enum AppointmentType {
    INITIAL_CONSULTATION
    FOLLOW_UP
    ROUTINE_CHECKUP
    EMERGENCY
    PROCEDURE
    LAB_REVIEW
    DIET_CONSULTATION
    PHYSIOTHERAPY_SESSION
    YOGA_SESSION
    AYURVEDA_CONSULTATION
    HOMEOPATHY_CONSULTATION
    COUNSELING
    WOUND_CARE
    DIABETES_EDUCATION
}

enum AppointmentMode {
    IN_PERSON
    VIDEO
    AUDIO
    CHAT
    HOME_VISIT
}

enum AppointmentStatus {
    SCHEDULED
    CONFIRMED
    CHECKED_IN
    IN_PROGRESS
    COMPLETED
    CANCELLED
    NO_SHOW
    RESCHEDULED
}

enum PaymentStatus {
    PENDING
    PROCESSING
    SUCCEEDED
    FAILED
    CANCELLED
    REFUNDED
    PAID
    WAIVED
}

enum PracticeType {
    INDIVIDUAL
    CLINIC
    HOSPITAL
    MULTI_SPECIALTY
}

enum DoctorStatus {
    ACTIVE
    INACTIVE
    SUSPENDED
    ON_LEAVE
    PENDING_VERIFICATION
}

enum PrescriptionStatus {
    DRAFT
    ACTIVE
    PARTIALLY_DISPENSED
    FULLY_DISPENSED
    CANCELLED
    EXPIRED
}

enum MedicationFrequency {
    ONCE_DAILY
    TWICE_DAILY
    THREE_TIMES_DAILY
    FOUR_TIMES_DAILY
    EVERY_4_HOURS
    EVERY_6_HOURS
    EVERY_8_HOURS
    EVERY_12_HOURS
    ONCE_WEEKLY
    TWICE_WEEKLY
    AS_NEEDED
    BEFORE_MEALS
    AFTER_MEALS
    AT_BEDTIME
    CUSTOM
}

enum DurationUnit {
    DAYS
    WEEKS
    MONTHS
}

enum MedicationPrescriptionStatus {
    ACTIVE
    COMPLETED
    DISCONTINUED
    ON_HOLD
}

enum NoteStatus {
    DRAFT
    COMPLETED
    SIGNED
    AMENDED
}

enum TemplateType {
    PRESCRIPTION
    CONSULTATION_NOTE
    TREATMENT_PLAN
    DIET_PLAN
    EXERCISE_PLAN
    PATIENT_EDUCATION
    REFERRAL_LETTER
    DISCHARGE_SUMMARY
    MEDICAL_CERTIFICATE
}

enum ScheduleType {
    RECURRING
    SPECIFIC_DATE
    BLOCKED
}

enum DrugInteractionSeverity {
    MINOR
    MODERATE
    MAJOR
    CONTRAINDICATION
    CONTRAINDICATED
}

enum HSPSpecialization {
    NURSE
    DIETITIAN
    NUTRITIONIST
    PHYSIOTHERAPIST
    OCCUPATIONAL_THERAPIST
    CARE_COORDINATOR
    AYURVEDA_PRACTITIONER
    YOGA_INSTRUCTOR
    HOMEOPATH
    UNANI_PRACTITIONER
    SIDDHA_PRACTITIONER
    NATUROPATH
    PHARMACIST
    PSYCHOLOGIST
    SPEECH_THERAPIST
    DIABETES_EDUCATOR
    WOUND_CARE_SPECIALIST
    RESPIRATORY_THERAPIST
}

enum AYUSHSpecialty {
    AYURVEDA
    YOGA
    UNANI
    SIDDHA
    HOMEOPATHY
    NATUROPATHY
}

enum HSPStatus {
    ACTIVE
    INACTIVE
    SUSPENDED
    ON_LEAVE
    PENDING_VERIFICATION
}

enum AssignmentStatus {
    ACTIVE
    COMPLETED
    CANCELLED
    ON_HOLD
}

enum HSPTreatmentType {
    DIET_PLAN
    EXERCISE_PLAN
    PHYSIOTHERAPY
    YOGA_THERAPY
    WOUND_CARE
    DIABETES_EDUCATION
    RESPIRATORY_THERAPY
    OCCUPATIONAL_THERAPY
    SPEECH_THERAPY
    PSYCHOLOGICAL_COUNSELING
    AYURVEDA_TREATMENT
    HOMEOPATHY_TREATMENT
    NURSING_CARE
}

enum TreatmentPlanStatus {
    DRAFT
    PENDING_APPROVAL
    ACTIVE
    ON_HOLD
    COMPLETED
    CANCELLED
}

enum SessionStatus {
    SCHEDULED
    IN_PROGRESS
    COMPLETED
    CANCELLED
    NO_SHOW
}

enum SessionMode {
    IN_PERSON
    VIDEO
    HOME_VISIT
}

enum HomeVisitStatus {
    SCHEDULED
    EN_ROUTE
    ARRIVED
    IN_PROGRESS
    COMPLETED
    CANCELLED
    PATIENT_NOT_AVAILABLE
}

enum WoundType {
    SURGICAL
    PRESSURE_INJURY
    DIABETIC_ULCER
    VENOUS_ULCER
    ARTERIAL_ULCER
    TRAUMATIC
    BURN
    SKIN_TEAR
    OTHER
}

enum ExudateAmount {
    NONE
    SCANT
    SMALL
    MODERATE
    LARGE
    COPIOUS
}

enum HealingTrend {
    IMPROVING
    STABLE
    DETERIORATING
}

enum MedicationLogStatus {
    PENDING
    TAKEN
    SKIPPED
    LATE
    MISSED
}

enum SideEffectSeverity {
    MILD
    MODERATE
    SEVERE
    LIFE_THREATENING
}

enum RefillStatus {
    PENDING
    APPROVED
    DENIED
    DISPENSED
    COMPLETED
    CANCELLED
}

enum MealType {
    BREAKFAST
    MORNING_SNACK
    LUNCH
    AFTERNOON_SNACK
    DINNER
    EVENING_SNACK
    OTHER
}

enum ExerciseIntensity {
    LOW
    MODERATE
    HIGH
    VERY_HIGH
}

enum GoalCategory {
    WEIGHT
    BLOOD_PRESSURE
    BLOOD_SUGAR
    EXERCISE
    NUTRITION
    MEDICATION_ADHERENCE
    SLEEP
    STRESS
    CUSTOM
    WEIGHT_MANAGEMENT
    BLOOD_SUGAR_CONTROL
    BLOOD_PRESSURE_CONTROL
    DIET
    STRESS_MANAGEMENT
    QUIT_SMOKING
}

enum GoalStatus {
    NOT_STARTED
    IN_PROGRESS
    ACHIEVED
    MISSED
    CANCELLED
    COMPLETED
    PAUSED
    ABANDONED
}

enum CaregiverAccessLevel {
    VIEW_ONLY
    VIEW_AND_LOG
    FULL_ACCESS
    VIEW_AND_REMIND
    EMERGENCY_ONLY
}

enum CaregiverAccessStatus {
    PENDING
    ACTIVE
    REVOKED
    EXPIRED
}

enum ReminderType {
    MEDICATION
    APPOINTMENT
    VITAL_RECORDING
    EXERCISE
    MEAL
    WATER_INTAKE
    CUSTOM
    MEAL_LOGGING
}

enum ReminderStatus {
    SCHEDULED
    SENT
    ACKNOWLEDGED
    SNOOZED
    EXPIRED
    ACTIVE
    PAUSED
    COMPLETED
    CANCELLED
}

enum ContentType {
    ARTICLE
    VIDEO
    INFOGRAPHIC
    FAQ
    GUIDE
    QUIZ
    CHECKLIST
}

enum ContentDifficulty {
    BEGINNER
    INTERMEDIATE
    ADVANCED
}

enum MessageSenderType {
    PATIENT
    DOCTOR
    HSP
    SYSTEM
    CAREGIVER
}

enum ConversationType {
    DIRECT
    CARE_TEAM
    PATIENT_FAMILY
    PROVIDER_GROUP
}

enum ConversationStatus {
    OPEN
    CLOSED
    ARCHIVED
    ACTIVE
}

enum MessageContentType {
    TEXT
    IMAGE
    DOCUMENT
    AUDIO
    VIDEO
    PRESCRIPTION
    LAB_RESULT
    VITAL_READING
}

enum VitalDataType {
    NUMERIC
    COMPOUND
    TEXT
    BOOLEAN
    SCALE
}

enum VitalCategory {
    CARDIOVASCULAR
    METABOLIC
    RESPIRATORY
    ANTHROPOMETRIC
    TEMPERATURE
    PAIN
    NEUROLOGICAL
    RENAL
    OTHER
}

enum VitalSource {
    MANUAL
    DEVICE_SYNC
    WEARABLE
    LAB_IMPORT
    HOME_MONITORING
}

enum VitalStatus {
    NORMAL
    BORDERLINE
    ABNORMAL
    CRITICAL
}

enum AlertLevel {
    INFO
    WARNING
    CRITICAL
    EMERGENCY
}

enum PrakritiType {
    VATA
    PITTA
    KAPHA
    VATA_PITTA
    PITTA_KAPHA
    VATA_KAPHA
    TRIDOSHA
}

enum AyurvedaTreatmentType {
    PANCHAKARMA
    SHAMANA
    RASAYANA
    VAJIKARANA
    KAYAKALPA
    DINACHARYA
    RITUCHARYA
}

enum PanchakarmaPhase {
    POORVAKARMA
    PRADHANAKARMA
    PASCHATKARMA
}

enum CaseStatus {
    ACTIVE
    IMPROVING
    STABLE
    CLOSED
    REFERRED
}

enum ProgressDirection {
    MARKED_IMPROVEMENT
    MODERATE_IMPROVEMENT
    SLIGHT_IMPROVEMENT
    NO_CHANGE
    SLIGHT_DETERIORATION
    MODERATE_DETERIORATION
    MARKED_DETERIORATION
}

enum ABDMRecordType {
    PRESCRIPTION
    DIAGNOSTIC_REPORT
    DISCHARGE_SUMMARY
    OP_CONSULTATION
    IMMUNIZATION_RECORD
    HEALTH_DOCUMENT
    WELLNESS_RECORD
}

enum ABDMConsentStatus {
    REQUESTED
    GRANTED
    DENIED
    EXPIRED
    REVOKED
}

enum MedicalTermType {
    CONDITION
    SYMPTOM
    MEDICATION
    PROCEDURE
    BODY_PART
    VITAL_SIGN
    LAB_TEST
    INSTRUCTION
}

enum EconomicCategory {
    APL
    BPL
    EWS
}

model User {
    id                    String       @id @default(uuid())
    email                 String       @unique
    passwordHash  String?   @db.VarChar(255)
    name          String?   @db.VarChar(255)
    image         String?   @db.VarChar(500)
    emailVerified DateTime? @db.Timestamptz(6)
    role                  UserRole
    accountStatus               UserAccountStatus?          @default(PENDING_VERIFICATION)
    firstName             String
    lastName              String
    middleName                  String?                     @db.VarChar(100)
    phone                 String?
    dateOfBirth                 DateTime?                   @db.Date
    gender                      UserGender?
    emailVerifiedLegacy         Boolean?                    @default(false)
    emailVerificationToken      String?                     @db.VarChar(255)
    passwordResetToken          String?                     @db.VarChar(255)
    passwordResetExpires        DateTime?                   @db.Timestamptz(6)
    twoFactorEnabled            Boolean?                    @default(false)
    twoFactorSecret             String?                     @db.VarChar(255)
    failedLoginAttempts         Int?                        @default(0)
    lockedUntil                 DateTime?                   @db.Timestamptz(6)
    lastLoginAt           DateTime?
    profilePictureUrl           String?                     @db.VarChar(500)
    timezone              String       @default("Asia/Kolkata")
    locale                      String?                     @default("en") @db.VarChar(10)
    preferences                 Json?
    termsAcceptedAt             DateTime?                   @db.Timestamptz(6)
    privacyPolicyAcceptedAt     DateTime?                   @db.Timestamptz(6)
    hipaaConsentDate            DateTime?                   @db.Timestamptz(6)
    createdAt             DateTime     @default(now())
    updatedAt             DateTime     @updatedAt
    deletedAt                   DateTime?                   @db.Timestamptz(6)
    fullName                    String?                     @db.VarChar(255)
    appointmentSlots            AppointmentSlot[]
    appointments                Appointment[]
    auditLogs             AuditLog[]
    carePlanTemplates           CarePlanTemplate[]
    doctorAvailabilities        DoctorAvailability[]
    doctorProfile               Doctor?                     @relation("UserDoctorProfile")
    verifiedDoctors             Doctor[]                    @relation("UserVerifiedDoctors")
    healthcareProvider          HealthcareProvider?
    verifiedHealthcareProviders HealthcareProvider[]        @relation("UserVerifiedHealthcareProviders")
    hspProfile                  Hsp?                        @relation("UserHspProfile")
    verifiedHsps                Hsp[]                       @relation("UserVerifiedHsps")
    notifications         Notification[]
    patientConsentOtps          PatientConsentOtp[]         @relation("RequestedByUser")
    patientDoctorAssignments    PatientDoctorAssignment[]
    patientProviderAssignments  PatientProviderAssignment[]
    patientProfile              Patient?
    providers                   Provider[]
    scheduledEvents             ScheduledEvent[]
    userDevices                 UserDevice[]
    userRoles                   UserRoleAssignment[]
    accounts                    Account[]
    sessions                    Session[]
    accountLinks                AccountLink[]
    verifiedPatientAllergies    PatientAllergy[]
    resolvedMedicationAlerts    MedicationSafetyAlert[]
    createdMedicationAlerts     MedicationSafetyAlert[]     @relation("SafetyAlertCreatedBy")
    acknowledgedEmergencyAlerts EmergencyAlert[]            @relation("EmergencyAlertAcknowledged")
    resolvedEmergencyAlerts     EmergencyAlert[]            @relation("EmergencyAlertResolved")
    vitalAlertRules             VitalAlertRule[]
    addedDevices                ConnectedDevice[]
    createdConsultations        VideoConsultation[]         @relation("ConsultationCreatedBy")
    consultationNotesCreated    ConsultationNote[]          @relation("ConsultationNoteCreatedBy")
    adherenceLogsRecorded       AdherenceLog[]
    caregiverAccessTo           CaregiverAccess[]
    reviewedClinicalDiagnoses   ClinicalDiagnosis[]
    createdPatientDoctorAssignments PatientDoctorAssignment[] @relation("CreatedByUserPatientDoctorAssignments")
    consentGrantedAssignments   PatientDoctorAssignment[]   @relation("ConsentGrantedByUser")
    verifiedPatientConsentOtps  PatientConsentOtp[]         @relation("VerifiedByUser")
    password              String
    phoneVerified         Boolean      @default(false)
    status                UserStatus   @default(ACTIVE)
    language              String       @default("en")
    abhaId                String?      @unique
    abhaAddress           String?
    aadhaarVerified       Boolean      @default(false)
    doctor                Doctor?
    patient               Patient?
    hsp                   HSP?
    sentMessages          Message[]    @relation("MessageSender")
    caregiverAccess       CaregiverAccess[]
    @@index([role], map: "users_role")
    @@map("users")
}

model Doctor {
    id                      String              @id @default(uuid())
    userId                  String              @unique
    doctorId                            String                          @unique @db.VarChar(50)
    organizationId                      String?                         @db.Uuid
    medicalLicenseNumber                String                          @unique @db.VarChar(100)
    npiNumber                           String?                         @unique @db.VarChar(20)
    boardCertifications                 String[]                        @default([])
    medicalSchool                       String?                         @db.VarChar(255)
    residencyPrograms                   Json?                           @default("[]")
    specialties                         String[]                        @default([])
    subSpecialties                      String[]                        @default([])
    yearsOfExperience                   Int?
    capabilities                        String[]                        @default(["prescribe_medications", "order_tests", "diagnose", "create_treatment_plans", "create_care_plans", "modify_medications", "monitor_vitals", "patient_education", "care_coordination", "emergency_response"])
    isVerified                          Boolean?                        @default(false)
    verificationDocuments               Json?                           @default("[]")
    verificationDate                    DateTime?
    verifiedBy                          String?                         @db.Uuid
    consultationFee         Decimal             @db.Decimal(10, 2)
    availabilitySchedule                Json?                           @default("{\"friday\": {\"end\": \"17:00\", \"start\": \"09:00\", \"available\": true}, \"monday\": {\"end\": \"17:00\", \"start\": \"09:00\", \"available\": true}, \"sunday\": {\"available\": false}, \"tuesday\": {\"end\": \"17:00\", \"start\": \"09:00\", \"available\": true}, \"saturday\": {\"available\": false}, \"thursday\": {\"end\": \"17:00\", \"start\": \"09:00\", \"available\": true}, \"wednesday\": {\"end\": \"17:00\", \"start\": \"09:00\", \"available\": true}}")
    languagesSpoken         String[]            @default(["en", "hi"])
    notificationPreferences             Json?                           @default("{\"patient_updates\": true, \"emergency_alerts\": true, \"peer_consultations\": true, \"system_notifications\": true, \"appointmentReminders\": true}")
    practiceName            String?
    practiceAddress                     Json?                           @default("{}")
    practicePhone                       String?                         @db.VarChar(20)
    biography                           String?                         @db.Text
    signaturePic                        String?
    razorpayAccountId                   String?                         @db.VarChar(255)
    totalPatients                       Int?                            @default(0)
    activeTreatmentPlans                Int?                            @default(0)
    activeCarePlans                     Int?                            @default(0)
    averageRating           Float?
    totalReviews                        Int?                            @default(0)
    isAvailableOnline                   Boolean?                        @default(true)
    isAcceptingNewPatients  Boolean             @default(true)
    offersOnlineConsultations           Boolean?                        @default(false)
    emergencyAvailability               Boolean?                        @default(false)
    isActive                            Boolean?                        @default(true)
    createdAt               DateTime            @default(now())
    updatedAt               DateTime            @updatedAt
    deletedAt                           DateTime?
    specialtyId                         Int?
    profilePictureUrl                   String?
    bannerImageUrl                      String?
    qualificationDetails                Json?                           @default("[]")
    registrationDetails                 Json?                           @default("{}")
    subscriptionDetails                 Json?                           @default("{}")
    signatureImageUrl                   String?
    signatureData                       String?
    gender                              String?                         @db.VarChar(20)
    mobileNumber                        String?                         @db.VarChar(20)
    appointments                        Appointment[]
    carePlans                           CarePlan[]
    clinics                             Clinic[]
    organization                        Organization?                   @relation(fields: [organizationId], references: [id])
    specialty                           Specialty?                      @relation(fields: [specialtyId], references: [id])
    user                    User                @relation(fields: [userId], references: [id], onDelete: Cascade)
    verifier                            User?                           @relation("UserVerifiedDoctors", fields: [verifiedBy], references: [id], onDelete: NoAction, onUpdate: NoAction)
    hsps                                Hsp[]
    notifications                       Notification[]
    primaryPatientConsentOtps           PatientConsentOtp[]             @relation("PrimaryDoctorPatientConsentOtps")
    secondaryPatientConsentOtps         PatientConsentOtp[]             @relation("SecondaryDoctorPatientConsentOtps")
    assignedPatientDoctorAssignments    PatientDoctorAssignment[]       @relation("AssignedByDoctorPatientDoctorAssignments")
    doctorAssignments                   PatientDoctorAssignment[]       @relation("DoctorAssignments")
    primaryDoctorAssignments            PatientDoctorAssignment[]       @relation("PrimaryDoctorAssignments")
    secondaryDoctorAssignments          PatientDoctorAssignment[]       @relation("SecondaryDoctorAssignments")
    assignedCarePlans                   CarePlan[]                      @relation("AssignedDoctorCarePlans")
    patientProviderConsentHistories     PatientProviderConsentHistory[]
    patients                PatientDoctorAssignment[]
    primarySecondaryDoctorAssignments   SecondaryDoctorAssignment[]     @relation("PrimaryDoctorSecondaryDoctorAssignments")
    secondarySecondaryDoctorAssignments SecondaryDoctorAssignment[]     @relation("SecondaryDoctorSecondaryDoctorAssignments")
    prescriptions           Prescription[]
    treatmentPlans                      TreatmentPlan[]
    videoConsultations                  VideoConsultation[]
    labOrders               LabOrder[]
    symptomAssessments                  SymptomAssessment[]
    clinicalDiagnoses                   ClinicalDiagnosis[]
    businessId              String              @unique
    registrationNumber      String
    registrationCouncil     String
    registrationState       String?
    registrationVerified    Boolean             @default(false)
    registrationVerifiedAt  DateTime?
    qualifications          Json
    specializations         String[]
    primarySpecialization   String
    experience              Int
    practiceType            PracticeType        @default(INDIVIDUAL)
    followUpFee             Decimal?            @db.Decimal(10, 2)
    currency                String              @default("INR")
    consultationDuration    Int                 @default(15)
    followUpDuration        Int                 @default(10)
    isAvailableForVideo     Boolean             @default(true)
    isAvailableForChat      Boolean             @default(true)
    digitalSignature        String?
    prescriptionHeader      String?
    prescriptionFooter      String?
    totalRatings            Int                 @default(0)
    totalConsultations      Int                 @default(0)
    hprId                   String?
    hprVerified             Boolean             @default(false)
    status                  DoctorStatus        @default(ACTIVE)
    consultationNotes       ConsultationNote[]
    availability            DoctorAvailability[]
    templates               DoctorTemplate[]
    riskScores              PatientRiskScore[]
    @@index([registrationNumber])
    @@map("doctors")
}

model PatientDoctorAssignment {
    id              String          @id @default(uuid())
    patientId       String
    doctorId        String
    primaryDoctorId          String?                               @db.Uuid
    secondaryDoctorId        String?                               @db.Uuid
    secondaryHspId           String?                               @db.Uuid
    assignmentType           PatientDoctorAssignmentType           @default(SPECIALIST)
    permissions              Json?                                 @default("{\"can_view_patient\": true, \"can_create_care_plans\": false, \"can_modify_care_plans\": false, \"can_prescribe\": false, \"can_order_tests\": false, \"can_access_full_history\": false}")
    specialtyFocus           String[]                              @default([])
    carePlanIds              String[]                              @default([]) @db.Uuid
    assignedByDoctorId       String?                               @db.Uuid
    assignedByAdminId        String?                               @db.Uuid
    patientConsentRequired   Boolean?                              @default(false)
    patientConsentStatus     PatientDoctorAssignmentConsentStatus? @default(NOT_REQUIRED)
    accessGranted            Boolean?                              @default(false)
    consentMethod            String?                               @db.VarChar(20)
    consentOtp               String?                               @db.VarChar(10)
    consentOtpExpiresAt      DateTime?
    consentGrantedAt         DateTime?
    consentGrantedBy         String?                               @db.Uuid
    assignmentStartDate      DateTime?
    assignmentEndDate        DateTime?
    expiresAt                DateTime?
    isActive                 Boolean?                              @default(true)
    assignmentReason         String?
    notes                    String?
    requiresSameOrganization Boolean?                              @default(false)
    createdBy                String?                               @db.Uuid
    createdAt                DateTime?
    updatedAt                DateTime?                             @updatedAt
    deletedAt                DateTime?
    assignedByAdmin          User?                                 @relation(fields: [assignedByAdminId], references: [id], onDelete: NoAction, onUpdate: NoAction)
    assignedByDoctor         Doctor?                               @relation("AssignedByDoctorPatientDoctorAssignments", fields: [assignedByDoctorId], references: [id], onDelete: NoAction, onUpdate: NoAction)
    createdByUser            User?                                 @relation("CreatedByUserPatientDoctorAssignments", fields: [createdBy], references: [id], onDelete: NoAction, onUpdate: NoAction)
    doctor          Doctor          @relation(fields: [doctorId], references: [id], onDelete: Cascade)
    primaryDoctor            Doctor?                               @relation("PrimaryDoctorAssignments", fields: [primaryDoctorId], references: [id], onDelete: NoAction, onUpdate: NoAction)
    secondaryDoctor          Doctor?                               @relation("SecondaryDoctorAssignments", fields: [secondaryDoctorId], references: [id], onDelete: NoAction, onUpdate: NoAction)
    secondaryHsp             Hsp?                                  @relation("SecondaryHspAssignments", fields: [secondaryHspId], references: [id], onDelete: NoAction, onUpdate: NoAction)
    consentGrantedByUser     User?                                 @relation("ConsentGrantedByUser", fields: [consentGrantedBy], references: [id], onDelete: NoAction, onUpdate: NoAction)
    consentOtps              PatientConsentOtp[]                   @relation("PatientDoctorAssignmentOtps")
    patient         Patient         @relation(fields: [patientId], references: [id], onDelete: Cascade)
    isPrimary       Boolean         @default(false)
    assignedAt      DateTime        @default(now())
    assignedBy      String?
    status          AssignmentStatus @default(ACTIVE)
    @@index([patientId])
    @@map("patient_doctor_assignments")
    @@unique([patientId, doctorId])
}

model DoctorAvailability {
    id              String          @id @default(uuid())
    doctorId        String
    dayOfWeek       Int?
    startTime       String
    endTime         String
    isAvailable            Boolean?  @default(true)
    slotDuration    Int             @default(15)
    maxAppointmentsPerSlot Int?      @default(1)
    breakStartTime         DateTime? @db.Time(6)
    breakEndTime           DateTime? @db.Time(6)
    createdAt              DateTime
    updatedAt              DateTime  @updatedAt
    deletedAt              DateTime?
    user                   User      @relation(fields: [doctorId], references: [id], onDelete: NoAction, onUpdate: NoAction)
    scheduleType    ScheduleType
    specificDate    DateTime?       @db.Date
    consultationType AppointmentMode[]
    locationId      String?
    locationName    String?
    isActive        Boolean         @default(true)
    isOverride      Boolean         @default(false)
    overrideReason  String?
    doctor          Doctor          @relation(fields: [doctorId], references: [id], onDelete: Cascade)
    @@index([doctorId, specificDate])
    @@map("doctor_availability")
}

model DoctorTemplate {
    id              String          @id @default(uuid())
    doctorId        String
    type            TemplateType
    name            String
    description     String?
    content         Json
    specialty       String?
    conditions      String[]
    tags            String[]
    usageCount      Int             @default(0)
    lastUsedAt      DateTime?
    isPublic        Boolean         @default(false)
    sharedWith      String[]
    isActive        Boolean         @default(true)
    createdAt       DateTime        @default(now())
    updatedAt       DateTime        @updatedAt
    doctor          Doctor          @relation(fields: [doctorId], references: [id], onDelete: Cascade)
    @@map("doctor_templates")
    @@index([doctorId, type])
}

model Prescription {
    id                  String              @id @default(uuid())
    patientId           String
    prescribingDoctorId    String? @db.Uuid
    prescribingHspId       String? @db.Uuid
    organizationId         String? @db.Uuid
    prescriptionNumber  String              @unique
    externalPrescriptionId String? @db.VarChar(100)
    medicationName String  @db.VarChar(255)
    genericName    String? @db.VarChar(255)
    ndcNumber      String? @db.VarChar(20)
    rxnormCode     String? @db.VarChar(20)
    strength              String  @db.VarChar(50)
    dosageForm            String  @db.VarChar(50) // tablet, capsule, liquid, injection, etc.
    routeOfAdministration String  @db.VarChar(30) // oral, topical, injection, etc.
    doseAmount            Decimal @db.Decimal(10, 3)
    doseUnit              String  @db.VarChar(20)
    frequency             String  @db.VarChar(50)
    frequencyPerDay       Int?
    dosingSchedule        Json    @default("[]")
    sigInstructions     String  @db.Text
    patientInstructions String? @db.Text
    foodInstructions    String? @db.VarChar(100) // with_food, without_food, etc.
    quantityPrescribed Int
    quantityUnit       String @db.VarChar(20)
    daysSupply         Int?
    refillsAllowed     Int    @default(0)
    refillsUsed        Int    @default(0)
    indication     String?  @db.VarChar(255)
    diagnosisCodes String[] @default([])
    isControlledSubstance Boolean @default(false)
    deaSchedule           String? @db.VarChar(5)
    prescribedDate DateTime  @default(now())
    startDate      DateTime?
    endDate        DateTime?
    expirationDate DateTime?
    status              PrescriptionStatus  @default(ACTIVE)
    discontinuationReason String? @db.VarChar(100)
    pharmacyId    String? @db.Uuid
    pharmacyName  String? @db.VarChar(255)
    pharmacyPhone String? @db.VarChar(20)
    ePrescribingId        String?   @db.VarChar(100)
    transmittedToPharmacy Boolean   @default(false)
    transmissionDate      DateTime?
    estimatedCost     Decimal? @db.Decimal(10, 2)
    insuranceCoverage Json     @default("{}")
    drugInteractions Json @default("[]")
    allergyAlerts    Json @default("[]")
    warnings         Json @default("[]")
    prescriberNpi       String? @db.VarChar(20)
    prescriberDea       String? @db.VarChar(20)
    electronicSignature String? @db.Text
    requiresMonitoring   Boolean @default(false)
    monitoringParameters Json    @default("[]")
    metadata  Json      @default("{}")
    createdAt           DateTime            @default(now())
    updatedAt           DateTime            @updatedAt
    deletedAt DateTime?
    patient             Patient             @relation(fields: [patientId], references: [id])
    prescribingDoctor Doctor?        @relation(fields: [prescribingDoctorId], references: [id])
    prescribingHsp    Hsp?           @relation(fields: [prescribingHspId], references: [id])
    organization      Organization?  @relation(fields: [organizationId], references: [id])
    adherenceLogs     AdherenceLog[]
    doctorId            String
    appointmentId       String?
    diagnosis           String[]
    icdCodes            String[]
    clinicalNotes       String?
    vitalsSnapshot      Json?
    prescribedAt        DateTime            @default(now())
    validUntil          DateTime?
    digitallySignedAt   DateTime?
    signatureHash       String?
    abdmDocumentId      String?
    doctor              Doctor              @relation(fields: [doctorId], references: [id])
    appointment         Appointment?        @relation(fields: [appointmentId], references: [id])
    medications         PrescriptionMedication[]
    labOrders           LabOrder[]
    dispensingRecords   DispensingRecord[]
    @@index([doctorId, prescribedAt])
    @@map("prescriptions")
}

model PrescriptionMedication {
    id                  String              @id @default(uuid())
    prescriptionId      String
    medicineId          String?
    medicineName        String
    genericName         String?
    strength            String?
    dosageForm          String
    dosage              String
    frequency           MedicationFrequency
    frequencyCustom     String?
    timing              String[]
    timingInstructions  String?
    duration            Int
    durationUnit        DurationUnit        @default(DAYS)
    quantity            Int?
    instructions        String?
    instructionsHi      String?
    warnings            String[]
    refillsAllowed      Int                 @default(0)
    refillsUsed         Int                 @default(0)
    allowGenericSubstitution Boolean        @default(true)
    status              MedicationPrescriptionStatus @default(ACTIVE)
    interactionWarnings Json?
    prescription        Prescription        @relation(fields: [prescriptionId], references: [id], onDelete: Cascade)
    medicine            Medicine?           @relation(fields: [medicineId], references: [id])
    adherenceLogs       MedicationLog[]
    @@map("prescription_medications")
}

model Medicine {
    id                  String              @id @default(uuid())
    name                String
    type            String?      @default("tablet") @db.VarChar(1000)
    description     String?      @db.VarChar(1000)
    details         Json?        @db.Json
    creatorId       Int?
    publicMedicine  Boolean?     @default(true)
    isActive            Boolean             @default(true)
    algoliaObjectId String?      @db.VarChar(255)
    createdAt           DateTime            @default(now())
    updatedAt           DateTime            @updatedAt
    deletedAt       DateTime?
    medications     Medication[]
    nameHi              String?
    genericName         String?
    brandName           String?
    manufacturer        String?
    category            String?
    subcategory         String?
    drugClass           String?
    schedule            String?             // Schedule H, H1, X
    dosageForm          String
    strength            String?
    strengthUnit        String?
    packSize            Int?
    packUnit            String?
    mrp                 Decimal?            @db.Decimal(10, 2)
    dpcoControlled      Boolean             @default(false)
    interactions        Json?
    contraindications   String[]
    sideEffects         String[]
    storageInstructions String?
    prescriptionMedications PrescriptionMedication[]
    carePlanMedications     CarePlanMedication[]
    @@map("medicines")
    @@index([genericName])
}

model DrugInteraction {
    id                  String              @id @default(uuid())
    rxcuiOne               String                  @db.VarChar(50) // RxNorm identifier for first drug
    rxcuiTwo               String                  @db.VarChar(50) // RxNorm identifier for second drug
    drugNameOne            String                  @db.VarChar(255)
    drugNameTwo            String                  @db.VarChar(255)
    severityLevel          DrugInteractionSeverity
    interactionType        String                  @db.VarChar(100) // "pharmacokinetic", "pharmacodynamic", "duplicate"
    description         String
    clinicalEffect         String                  @db.Text
    managementAdvice       String                  @db.Text
    evidenceLevel          String                  @db.VarChar(10) // "HIGH", "MODERATE", "LOW"
    source                 String                  @default("RxNorm") @db.VarChar(50)
    lastUpdatedAt          DateTime                @updatedAt @db.Timestamptz(6)
    createdAt              DateTime                @default(now()) @db.Timestamptz(6)
    medicationSafetyAlerts MedicationSafetyAlert[]
    drug1Name           String
    drug1GenericName    String?
    drug2Name           String
    drug2GenericName    String?
    severity            DrugInteractionSeverity
    descriptionHi       String?
    mechanism           String?
    clinicalManagement  String?
    references          String[]
    isActive            Boolean             @default(true)
    @@unique([rxcuiOne, rxcuiTwo])
    @@index([drug2GenericName])
    @@map("drug_interactions")
}

model DispensingRecord {
    id                  String              @id @default(uuid())
    prescriptionId      String
    dispensedBy         String              // Pharmacy ID
    dispensedByName     String?
    dispensedAt         DateTime            @default(now())
    medicationsDispensed Json               // Array of { medicineId, quantity, batchNumber, expiryDate }
    totalAmount         Decimal?            @db.Decimal(10, 2)
    paymentMethod       String?
    paymentReference    String?
    notes               String?
    prescription        Prescription        @relation(fields: [prescriptionId], references: [id])
    @@map("dispensing_records")
    @@index([prescriptionId])
}

model ConsultationNote {
    id                  String          @id @default(uuid())
    consultationId String            @db.Uuid
    noteType       String            @db.VarChar(50)
    content        String            @db.Text
    timestamp      DateTime          @default(now())
    createdBy      String            @db.Uuid
    consultation   VideoConsultation @relation(fields: [consultationId], references: [id], onDelete: Cascade)
    creator        User              @relation("ConsultationNoteCreatedBy", fields: [createdBy], references: [id])
    appointmentId       String
    doctorId            String
    patientId           String
    chiefComplaint      String
    chiefComplaintHi    String?
    historyOfPresentIllness String?
    pastMedicalHistory  String?
    familyHistory       String?
    socialHistory       String?
    allergies           String[]
    currentMedications  Json?
    generalExamination  String?
    systemicExamination Json?
    vitals              Json?
    provisionalDiagnosis String[]
    differentialDiagnosis String[]
    icdCodes            String[]
    treatmentPlan       String?
    investigationsOrdered String[]
    referrals           Json?
    followUpPlan        String?
    patientEducation    String?
    attachments         Json?
    templateId          String?
    status              NoteStatus      @default(DRAFT)
    signedAt            DateTime?
    createdAt           DateTime        @default(now())
    updatedAt           DateTime        @updatedAt
    appointment         Appointment     @relation(fields: [appointmentId], references: [id])
    doctor              Doctor          @relation(fields: [doctorId], references: [id])
    @@index([patientId, createdAt])
    @@map("consultation_notes")
}

model LabOrder {
    id                  String          @id @default(uuid())
    orderNumber         String          @unique
    patientId           String
    doctorId            String             @db.Uuid
    consultationId      String?            @db.Uuid
    orderDate           DateTime           @default(now())
    priority            String             @default("routine") @db.VarChar(50)
    status              String          @default("ORDERED")
    category            LabTestCategory    @default(BLOOD_CHEMISTRY)
    orderedTests        Json               @default("[]")
    clinicalIndication  String?            @db.Text
    specialInstructions String?            @db.Text
    labFacilityName     String?            @db.VarChar(255)
    labFacilityCode     String?            @db.VarChar(100)
    collectionDate      DateTime?
    expectedResultDate  DateTime?
    resultsAvailable    Boolean            @default(false)
    resultsData         Json?              @default("{}")
    resultsPdfUrl       String?            @db.Text
    criticalValues      Boolean            @default(false)
    externalLabOrderId  String?            @db.VarChar(255)
    createdAt           DateTime        @default(now())
    updatedAt           DateTime        @updatedAt
    patient             Patient         @relation(fields: [patientId], references: [id])
    doctor              Doctor          @relation(fields: [orderedBy], references: [id])
    consultation        VideoConsultation? @relation(fields: [consultationId], references: [id])
    results             Json?
    prescriptionId      String?
    orderedBy           String
    tests               Json            // Array of { testCode, testName, instructions }
    urgency             String          @default("ROUTINE")
    clinicalNotes       String?
    labId               String?
    labName             String?
    scheduledAt         DateTime?
    collectionMethod    String?         // "LAB_VISIT", "HOME_COLLECTION"
    collectionAddress   String?
    resultsReceivedAt   DateTime?
    abnormalFindings    String[]
    estimatedCost       Decimal?        @db.Decimal(10, 2)
    actualCost          Decimal?        @db.Decimal(10, 2)
    paymentStatus       PaymentStatus   @default(PENDING)
    prescription        Prescription?   @relation(fields: [prescriptionId], references: [id])
    @@index([patientId, createdAt])
    @@map("lab_orders")
}

model HSP {
    id                      String            @id @default(uuid())
    userId                  String            @unique
    businessId              String            @unique
    specialization          HSPSpecialization
    registrationNumber      String?
    registrationCouncil     String?
    registrationVerified    Boolean           @default(false)
    qualifications          Json
    certifications          Json?
    experience              Int
    ayushRegistrationNumber String?
    ayushSpecialty          AYUSHSpecialty?
    languagesSpoken         String[]          @default(["en", "hi"])
    isAvailableForVideo     Boolean           @default(false)
    isAvailableForHomeVisit Boolean           @default(false)
    homeVisitRadius         Int?
    consultationFee         Decimal?          @db.Decimal(10, 2)
    homeVisitFee            Decimal?          @db.Decimal(10, 2)
    currency                String            @default("INR")
    status                  HSPStatus         @default(ACTIVE)
    averageRating           Float?
    totalRatings            Int               @default(0)
    createdAt               DateTime          @default(now())
    updatedAt               DateTime          @updatedAt
    user                    User              @relation(fields: [userId], references: [id], onDelete: Cascade)
    assignedPatients        HSPPatientAssignment[]
    treatmentPlans          HSPTreatmentPlan[]
    homeVisits              HomeVisit[]
    woundDocumentation      WoundDocumentation[]
    ayurvedaTreatments      AyurvedaTreatment[]
    yogaTherapies           YogaTherapy[]
    homeopathyCases         HomeopathyCase[]
    @@map("hsps")
    @@index([specialization])
}

model HSPPatientAssignment {
    id              String          @id @default(uuid())
    hspId           String
    patientId       String
    assignedBy      String
    assignedAt      DateTime        @default(now())
    purpose         String?
    startDate       DateTime
    endDate         DateTime?
    status          AssignmentStatus @default(ACTIVE)
    permissions     Json?
    hsp             HSP             @relation(fields: [hspId], references: [id], onDelete: Cascade)
    patient         Patient         @relation(fields: [patientId], references: [id], onDelete: Cascade)
    @@unique([hspId, patientId])
    @@map("hsp_patient_assignments")
}

model HSPTreatmentPlan {
    id              String          @id @default(uuid())
    hspId           String
    patientId       String
    type            HSPTreatmentType
    name            String
    nameHi          String?
    description     String?
    descriptionHi   String?
    goals           Json
    startDate       DateTime
    endDate         DateTime?
    frequency       String?
    totalSessions   Int?
    completedSessions Int           @default(0)
    status          TreatmentPlanStatus @default(ACTIVE)
    requiresApproval Boolean        @default(false)
    approvedBy      String?
    approvedAt      DateTime?
    progressNotes   Json?
    createdAt       DateTime        @default(now())
    updatedAt       DateTime        @updatedAt
    hsp             HSP             @relation(fields: [hspId], references: [id])
    patient         Patient         @relation(fields: [patientId], references: [id])
    sessions        TreatmentSession[]
    @@map("hsp_treatment_plans")
    @@index([patientId, status])
}

model TreatmentSession {
    id                  String          @id @default(uuid())
    treatmentPlanId     String
    scheduledAt         DateTime
    duration            Int
    status              SessionStatus   @default(SCHEDULED)
    mode                SessionMode
    completedAt         DateTime?
    notes               String?
    patientFeedback     String?
    patientRating       Int?
    goalsAddressed      String[]
    exercisesCompleted  Json?
    attachments         Json?
    treatmentPlan       HSPTreatmentPlan @relation(fields: [treatmentPlanId], references: [id], onDelete: Cascade)
    @@map("treatment_sessions")
    @@index([treatmentPlanId, scheduledAt])
}

model HomeVisit {
    id              String          @id @default(uuid())
    hspId           String
    patientId       String
    scheduledAt     DateTime
    actualArrival   DateTime?
    actualDeparture DateTime?
    address         String
    coordinates     Json?
    status          HomeVisitStatus @default(SCHEDULED)
    checkedInAt     DateTime?
    checkedInLocation Json?
    checkedOutAt    DateTime?
    visitType       String
    chiefComplaint  String?
    vitalsRecorded  Json?
    medicationsAdministered Json?
    proceduresPerformed Json?
    assessment      String?
    recommendations String?
    followUpRequired Boolean        @default(false)
    followUpDate    DateTime?
    alertsRaised    Json?
    createdAt       DateTime        @default(now())
    updatedAt       DateTime        @updatedAt
    hsp             HSP             @relation(fields: [hspId], references: [id])
    patient         Patient         @relation(fields: [patientId], references: [id])
    @@map("home_visits")
    @@index([patientId, scheduledAt])
}

model WoundDocumentation {
    id              String          @id @default(uuid())
    hspId           String
    patientId       String
    homeVisitId     String?
    woundId         String
    woundLocation   String
    woundType       WoundType
    etiology        String?
    length          Float
    width           Float
    depth           Float?
    area            Float?
    tissueType      Json
    woundEdges      String?
    periwoundSkin   String?
    exudateAmount   ExudateAmount
    exudateType     String?
    pressureInjuryStage String?
    painLevel       Int?
    cleansingSolution String?
    dressingType    String?
    dressingSecondary String?
    photos          Json?
    notes           String?
    healingTrend    HealingTrend?
    documentedAt    DateTime        @default(now())
    hsp             HSP             @relation(fields: [hspId], references: [id])
    patient         Patient         @relation(fields: [patientId], references: [id])
    @@map("wound_documentation")
    @@index([patientId, woundId, documentedAt])
}

model Patient {
    id                      String              @id @default(uuid())
    userId                  String              @unique
    organizationId                String?                             @db.Uuid
    medicalRecordNumber           String?                             @unique @db.VarChar(50)
    patientId                     String?                             @unique @db.VarChar(100)
    emergencyContacts             Json?                               @default("[]")
    insuranceInformation          Json?                               @default("{}")
    medicalHistory          Json?
    allergies               String[]
    currentMedications            Json?                               @default("[]")
    heightCm                      Decimal?                            @db.Decimal(5, 2)
    weightKg                      Decimal?                            @db.Decimal(5, 2)
    bloodType                     String?                             @db.VarChar(5)
    dateOfBirth             DateTime
    gender                  Gender
    primaryLanguage               String?                             @default("en") @db.VarChar(10)
    riskLevel                     String?                             @default("low") @db.VarChar(20)
    riskFactors                   Json?                               @default("[]")
    communicationPreferences      Json?                               @default("{\"language\": \"en\", \"time_zone\": \"UTC\", \"health_tips\": false, \"medication_reminders\": true, \"appointmentReminders\": true, \"research_participation\": false, \"preferred_contact_method\": \"email\"}")
    privacySettings               Json?                               @default("{\"share_with_family\": false, \"share_for_research\": false, \"data_sharing_consent\": false, \"marketing_communications\": false, \"provider_directory_listing\": true}")
    primaryCareDoctorId           String?                             @db.Uuid
    primaryCareHspId              String?                             @db.Uuid
    careCoordinatorId             String?                             @db.Uuid
    careCoordinatorType           String?                             @db.VarChar(10)
    overallAdherenceScore         Decimal?                            @db.Decimal(5, 2)
    lastAdherenceCalculation      DateTime?                           @db.Timestamptz(6)
    totalAppointments             Int?                                @default(0)
    missedAppointments            Int?                                @default(0)
    lastVisitDate                 DateTime?                           @db.Timestamptz(6)
    nextAppointmentDate           DateTime?                           @db.Timestamptz(6)
    isActive                      Boolean?                            @default(true)
    requiresInterpreter           Boolean?                            @default(false)
    hasMobilityIssues             Boolean?                            @default(false)
    createdAt               DateTime            @default(now())
    updatedAt               DateTime            @updatedAt
    deletedAt                     DateTime?                           @db.Timestamptz(6)
    linkedProviderId              String?                             @db.Uuid
    providerLinkedAt              DateTime?                           @db.Timestamptz(6)
    providerConsentGiven          Boolean?                            @default(false)
    providerConsentGivenAt        DateTime?                           @db.Timestamptz(6)
    providerConsentMethod         PatientProviderConsentMethodLegacy?
    adherenceRecords              AdherenceRecord[]
    appointments            Appointment[]
    auditLogs                     AuditLog[]
    carePlans               CarePlan[]
    medicationLogs          MedicationLog[]
    sideEffectReports             SideEffectReport[]
    refillRequests          RefillRequest[]
    dietPlans                     DietPlan[]
    workoutPlans                  WorkoutPlan[]
    mealLogs                      MealLog[]
    waterIntakeLogs               WaterIntakeLog[]
    exercisePlans                 ExercisePlan[]
    exerciseLogs            ExerciseLog[]
    dailyActivitySummaries        DailyActivitySummary[]
    healthGoals             HealthGoal[]
    caregiverAccess         CaregiverAccess[]
    notificationPreference        PatientNotificationPreference?
    reminders                     PatientReminder[]
    contentViews                  PatientContentView[]
    conversations                 MessageConversation[]
    settings                      PatientSettings?
    notifications           PatientNotificationPreference?
    patientAlerts                 PatientAlert[]
    patientConsentOtps            PatientConsentOtp[]
    patientDoctorAssignments      PatientDoctorAssignment[]
    patientProviderAssignments    PatientProviderAssignment[]
    patientProviderConsentHistory PatientProviderConsentHistory[]
    patientSubscriptions          PatientSubscription[]
    linkedProvider                Organization?                       @relation("patients_linked_provider_idToorganizations", fields: [linkedProviderId], references: [id])
    organization                  Organization?                       @relation(fields: [organizationId], references: [id])
    primaryCareDoctor             Doctor?                             @relation(fields: [primaryCareDoctorId], references: [id])
    primaryCareHsp                Hsp?                                @relation(fields: [primaryCareHspId], references: [id], onDelete: NoAction, onUpdate: NoAction)
    user                    User                @relation(fields: [userId], references: [id], onDelete: Cascade)
    paymentMethods                PaymentMethod[]
    payments                      Payment[]
    scheduledEvents               ScheduledEvent[]
    secondaryDoctorAssignments    SecondaryDoctorAssignment[]
    symptoms                      Symptom[]
    treatmentPlans                TreatmentPlan[]
    vitalReadings           VitalReading[]
    patientAllergies              PatientAllergy[]
    medicationSafetyAlerts        MedicationSafetyAlert[]
    emergencyAlerts               EmergencyAlert[]
    emergencyContactsNew          EmergencyContact[]
    connectedDevices              ConnectedDevice[]
    deviceReadings                DeviceReading[]
    videoConsultations            VideoConsultation[]
    labOrders               LabOrder[]
    gameProfile                   PatientGameProfile?
    prescriptions           Prescription[]
    medicalDevices                MedicalDevice[]
    adherenceLogs                 AdherenceLog[]
    reports                       Report[]
    symptomAssessments            SymptomAssessment[]
    clinicalDiagnoses             ClinicalDiagnosis[]
    businessId              String              @unique
    bloodGroup              String?
    address                 Json?
    emergencyContactName    String?
    emergencyContactPhone   String?
    emergencyContactRelation String?
    chronicConditions       String[]
    abhaId                  String?             @unique
    abhaAddress             String?
    aadhaarVerified         Boolean             @default(false)
    preferredLanguage       String              @default("en")
    preferredLanguages      String[]            @default(["en", "hi"])
    whatsappNumber          String?
    whatsappOptIn           Boolean             @default(false)
    smsOptIn                Boolean             @default(true)
    insuranceProvider       String?
    insurancePolicyNumber   String?
    insuranceValidUntil     DateTime?
    ayushmanBharatBeneficiary Boolean           @default(false)
    economicCategory        EconomicCategory?
    bplCardNumber           String?
    prakritiAssessment      Json?
    prakritiAssessedAt      DateTime?
    prakritiAssessedBy      String?
    totalPoints             Int                 @default(0)
    currentStreak           Int                 @default(0)
    longestStreak           Int                 @default(0)
    level                   Int                 @default(1)
    primaryDoctorId         String?
    doctors                 PatientDoctorAssignment[]
    hspAssignments          HSPPatientAssignment[]
    dietLogs                MealLog[]
    symptomReports          SymptomReport[]
    careTeam                CareTeam?
    hspTreatmentPlans       HSPTreatmentPlan[]
    homeVisits              HomeVisit[]
    woundDocumentation      WoundDocumentation[]
    ayurvedaTreatments      AyurvedaTreatment[]
    yogaTherapies           YogaTherapy[]
    homeopathyCases         HomeopathyCase[]
    prakritiAssessments     PrakritiAssessment[]
    abdmHealthRecords       ABDMHealthRecord[]
    abdmConsents            ABDMConsent[]
    badges                  PatientBadge[]
    achievements            PatientAchievement[]
    riskScores              PatientRiskScore[]
    @@index([riskLevel])
    @@map("patients")
}

model CarePlan {
    id                  String          @id @default(uuid())
    patientId           String
    createdByDoctorId         String?                 @db.Uuid
    createdByHspId            String?                 @db.Uuid
    assignedDoctorId          String?                 @db.Uuid
    assignedHspId             String?                 @db.Uuid
    organizationId            String?                 @db.Uuid
    title                     String                  @db.VarChar(255)
    description         String?
    planType                  String?                 @default("care_plan") @db.VarChar(20)
    chronicConditions         String[]                @default([])
    conditionSeverity         Json?                   @default("{}")
    riskFactors               Json?                   @default("[]")
    longTermGoals             Json?                   @default("[]")
    shortTermMilestones       Json?                   @default("[]")
    interventions             Json?                   @default("[]")
    lifestyleModifications    Json?                   @default("[]")
    monitoringParameters      Json?                   @default("[]")
    monitoringFrequency       Json?                   @default("{}")
    targetValues              Json?                   @default("{}")
    medications         CarePlanMedication[]
    medicationManagement      Json?                   @default("{}")
    startDate           DateTime
    endDate             DateTime?
    reviewFrequencyMonths     Int?                    @default(3)
    nextReviewDate            DateTime?
    status              TreatmentPlanStatus @default(ACTIVE)
    priority                  String?                 @default("MEDIUM") @db.VarChar(20)
    primaryCareManagerId      String?                 @db.Uuid
    careTeamMembers           Json?                   @default("[]")
    specialistReferrals       Json?                   @default("[]")
    patientEducationMaterials Json?                   @default("[]")
    selfManagementTasks       Json?                   @default("[]")
    patientGoals              Json?                   @default("[]")
    progressNotes             Json?                   @default("[]")
    outcomeMeasures           Json?                   @default("{}")
    qualityOfLifeScores       Json?                   @default("{}")
    emergencyActionPlan       Json?                   @default("{}")
    warningSigns              String[]                @default([])
    emergencyContacts         Json?                   @default("[]")
    details                   Json?
    channelId                 String?                 @db.VarChar(255)
    createdAt           DateTime        @default(now())
    updatedAt           DateTime        @updatedAt
    deletedAt                 DateTime?
    doctor                    Doctor?                 @relation(fields: [createdByDoctorId], references: [id])
    hsp                       Hsp?                    @relation(fields: [createdByHspId], references: [id], onDelete: NoAction, onUpdate: NoAction)
    organization              Organization?           @relation(fields: [organizationId], references: [id], onDelete: NoAction, onUpdate: NoAction)
    patient             Patient         @relation(fields: [patientId], references: [id], onDelete: Cascade)
    prescribedMedications     Medication[]            @relation("prescribed_medications")
    notifications             Notification[]
    scheduledEvents           ScheduledEvent[]
    symptoms                  Symptom[]
    vitalRequirements         VitalRequirement[]
    vitals                    Vital[]
    adherenceLogs             AdherenceLog[]
    appointments              Appointment[]
    diets                     CarePlanToDietPlan[]
    workouts                  CarePlanToWorkoutPlan[]
    exercisePlans             ExercisePlan[]
    reports                   Report[]
    assignedDoctor            Doctor?                 @relation("AssignedDoctorCarePlans", fields: [assignedDoctorId], references: [id], onDelete: NoAction, onUpdate: NoAction)
    assignedHsp               Hsp?                    @relation("AssignedHspCarePlans", fields: [assignedHspId], references: [id], onDelete: NoAction, onUpdate: NoAction)
    createdBy           String
    name                String
    nameHi              String?
    descriptionHi       String?
    condition           String
    icdCodes            String[]
    goals               Json
    @@index([patientId, status])
    @@map("care_plans")
}

model CarePlanMedication {
    id                  String          @id @default(uuid())
    carePlanId          String
    medicineId          String?
    medicineName        String
    genericName         String?
    strength            String?
    dosageForm          String
    dosage              String
    frequency           MedicationFrequency
    frequencyCustom     String?
    timing              String[]
    timingInstructions  String?
    startDate           DateTime
    endDate             DateTime?
    instructions        String?
    instructionsHi      String?
    status              MedicationPrescriptionStatus @default(ACTIVE)
    carePlan            CarePlan        @relation(fields: [carePlanId], references: [id], onDelete: Cascade)
    medicine            Medicine?       @relation(fields: [medicineId], references: [id])
    logs                MedicationLog[]
    @@map("care_plan_medications")
}

model MedicationLog {
    id                      String              @id @default(uuid())
    medicationId          String
    patientId               String
    scheduledAt     DateTime
    takenAt         DateTime?
    dosageTaken             String?
    notes                   String?
    adherenceStatus MedicationLogAdherenceStatus? @default(MISSED)
    reminderSent    Boolean?                      @default(false)
    createdAt               DateTime            @default(now())
    updatedAt             DateTime            @updatedAt
    medication            Medication          @relation(fields: [medicationId], references: [id], onDelete: Cascade)
    patient                 Patient             @relation(fields: [patientId], references: [id], onDelete: Cascade)
    sideEffects             Json?
    scheduledTime           DateTime
    actualTime              DateTime?
    status                  MedicationLogStatus @default(PENDING)
    skipReason              String?
    sideEffectsReported   Boolean             @default(false)
    carePlanMedicationId    String?
    prescriptionMedicationId String?
    recordedBy              String?
    recordedByRole          UserRole?
    pointsEarned            Int                 @default(0)
    carePlanMedication      CarePlanMedication? @relation(fields: [carePlanMedicationId], references: [id])
    prescriptionMedication  PrescriptionMedication? @relation(fields: [prescriptionMedicationId], references: [id])
    @@index([patientId, status])
    @@map("medication_logs")
}

model RefillRequest {
    id                  String          @id @default(uuid())
    medicationId    String
    patientId           String
    requestedAt         DateTime        @default(now())
    status              RefillStatus    @default(PENDING)
    processedAt     DateTime?
    processedBy     String?
    notes           String?
    quantity            Int
    medication      Medication   @relation(fields: [medicationId], references: [id], onDelete: Cascade)
    patient             Patient         @relation(fields: [patientId], references: [id], onDelete: Cascade)
    carePlanMedicationId String?
    medicineName        String
    reason              String?
    urgency             String          @default("NORMAL")
    reviewedAt          DateTime?
    reviewedBy          String?
    reviewNotes         String?
    @@index([patientId, status])
    @@map("refill_requests")
}

model VitalType {
    id              String          @id @default(uuid())
    name            String
    unit            String
    normalRangeMin  Float?
    normalRangeMax  Float?
    description       String?
    validationRules   Json?              @default("{}")
    createdAt         DateTime?
    updatedAt         DateTime?          @updatedAt
    deletedAt         DateTime?
    vitalReadings     VitalReading[]
    vitalRequirements VitalRequirement[]
    code            String          @unique
    nameHi          String?
    dataType        VitalDataType
    isCompound      Boolean         @default(false)
    components      Json?
    criticalMin     Float?
    criticalMax     Float?
    displayOrder    Int             @default(0)
    icon            String?
    color           String?
    category        VitalCategory
    isActive        Boolean         @default(true)
    readings        VitalReading[]
    @@index([unit])
    @@map("vital_types")
}

model VitalReading {
    id              String          @id @default(uuid())
    patientId       String
    vitalTypeId     String
    adherenceRecordId  String?                 @db.Uuid
    value           Float?
    unit               String?                 @db.VarChar(20)
    readingTime        DateTime
    deviceInfo         Json?                   @default("{}")
    isFlagged          Boolean?                @default(false)
    notes           String?
    attachments        Json?                   @default("[]")
    isValidated        Boolean?                @default(false)
    validatedBy        String?                 @db.Uuid
    createdAt          DateTime?
    updatedAt          DateTime?               @updatedAt
    deletedAt          DateTime?
    systolicValue      Decimal?                @db.Decimal(5, 2)
    diastolicValue     Decimal?                @db.Decimal(5, 2)
    pulseRate          Int?
    respiratoryRate    Int?
    oxygenSaturation   Decimal?                @db.Decimal(5, 2)
    alertLevel      AlertLevel?
    alertReasons       Json?                   @default("[]")
    adherenceRecord    AdherenceRecord?        @relation(fields: [adherenceRecordId], references: [id], onDelete: NoAction, onUpdate: NoAction)
    patient         Patient         @relation(fields: [patientId], references: [id], onDelete: Cascade)
    healthcareProvider HealthcareProvider?     @relation(fields: [validatedBy], references: [id], onDelete: NoAction, onUpdate: NoAction)
    vitalType       VitalType       @relation(fields: [vitalTypeId], references: [id])
    emergencyAlerts    EmergencyAlert[]
    deviceReadings     DeviceReading[]
    valueText       String?
    components      Json?
    recordedAt      DateTime        @default(now())
    recordedBy      String?
    recordedByRole  UserRole?
    source          VitalSource     @default(MANUAL)
    deviceId        String?
    deviceName      String?
    status          VitalStatus     @default(NORMAL)
    alertMessage    String?
    alertAcknowledgedAt DateTime?
    alertAcknowledgedBy String?
    circumstances   String?
    isVerified      Boolean         @default(false)
    verifiedBy      String?
    verifiedAt      DateTime?
    @@index([patientId, alertLevel])
    @@map("vital_readings")
}

model MealLog {
    id              String          @id @default(uuid())
    patientId       String
    dietPlanId      String?
    mealType        MealType
    loggedAt        DateTime      @default(now())
    totalCalories   Int?
    totalProtein    Float?
    totalCarbs      Float?
    totalFat        Float?
    totalFiber      Float?
    notes           String?
    moodBefore      Int?          // 1-5 scale
    moodAfter       Int?          // 1-5 scale
    photoUrl        String?
    patient         Patient         @relation(fields: [patientId], references: [id], onDelete: Cascade)
    dietPlan        DietPlan?     @relation(fields: [dietPlanId], references: [id])
    foods           Json            // Array of { name, quantity, unit, calories, carbs, protein, fat }
    mealTime        DateTime
    bloodSugarBefore Int?
    bloodSugarAfter Int?
    photos          Json?
    createdAt       DateTime        @default(now())
    @@index([patientId, mealTime])
    @@map("meal_logs")
}

model ExerciseLog {
    id              String          @id @default(uuid())
    patientId       String
    exercisePlanId  String?
    activityType    String
    name            String
    duration        Int?            // minutes
    caloriesBurned  Int?
    distance        Float?
    steps           Int?
    heartRateAvg    Int?
    heartRateMax    Int?
    intensity       ExerciseIntensity?
    notes           String?
    loggedAt        DateTime          @default(now())
    patient         Patient         @relation(fields: [patientId], references: [id], onDelete: Cascade)
    exercisePlan    ExercisePlan?     @relation(fields: [exercisePlanId], references: [id])
    activityName    String
    startTime       DateTime
    endTime         DateTime?
    distanceUnit    String?
    source          String?         // "manual", "google_fit", "apple_health"
    createdAt       DateTime        @default(now())
    @@index([patientId, startTime])
    @@map("exercise_logs")
}

model SymptomReport {
    id              String          @id @default(uuid())
    patientId       String
    symptoms        Json            // Array of { name, bodyPart, severity, description }
    overallSeverity Int             // 1-10
    startedAt       DateTime?
    notes           String?
    photos          Json?
    reportedAt      DateTime        @default(now())
    alertTriggered  Boolean         @default(false)
    alertLevel      AlertLevel?
    reviewedBy      String?
    reviewedAt      DateTime?
    reviewNotes     String?
    patient         Patient         @relation(fields: [patientId], references: [id], onDelete: Cascade)
    @@map("symptom_reports")
    @@index([patientId, reportedAt])
}

model HealthGoal {
    id              String          @id @default(uuid())
    patientId       String
    category        GoalCategory
    title             String
    description     String?
    targetValue     Float?
    currentValue    Float?
    unit              String?
    startDate       DateTime
    targetDate      DateTime
    completedAt     DateTime?
    status          GoalStatus      @default(NOT_STARTED)
    isPatientCreated  Boolean          @default(false)
    createdBy         String
    createdAt       DateTime        @default(now())
    updatedAt       DateTime        @updatedAt
    patient         Patient         @relation(fields: [patientId], references: [id], onDelete: Cascade)
    milestones      Json?
    progressLogs      GoalProgressLog[]
    name            String
    targetUnit      String?
    @@index([patientId, status])
    @@map("health_goals")
}

model Badge {
    id              String          @id @default(uuid())
    code            String          @unique
    name            String
    nameHi          String?
    description     String
    descriptionHi   String?
    category        String
    icon            String
    color           String?
    requirement     Json            // { type: "streak", value: 7 } or { type: "total_doses", value: 100 }
    pointsAwarded   Int             @default(0)
    isActive        Boolean         @default(true)
    patientBadges   PatientBadge[]
    @@map("badges")
}

model PatientBadge {
    id              String          @id @default(uuid())
    patientId       String
    badgeId         String
    earnedAt        DateTime        @default(now())
    patient         Patient         @relation(fields: [patientId], references: [id], onDelete: Cascade)
    badge           Badge           @relation(fields: [badgeId], references: [id])
    @@unique([patientId, badgeId])
    @@map("patient_badges")
}

model Achievement {
    id              String          @id @default(uuid())
    code            String          @unique
    name            String
    nameHi          String?
    description     String
    descriptionHi   String?
    type            String          // "streak", "completion", "milestone"
    threshold       Int
    pointsAwarded   Int             @default(0)
    isActive        Boolean         @default(true)
    patientAchievements PatientAchievement[]
    @@map("achievements")
}

model PatientAchievement {
    id              String          @id @default(uuid())
    patientId       String
    achievementId   String
    progress        Int             @default(0)
    completed       Boolean         @default(false)
    completedAt     DateTime?
    patient         Patient         @relation(fields: [patientId], references: [id], onDelete: Cascade)
    achievement     Achievement     @relation(fields: [achievementId], references: [id])
    @@unique([patientId, achievementId])
    @@map("patient_achievements")
}

model CaregiverAccess {
    id              String              @id @default(uuid())
    patientId       String
    caregiverId     String
    relationship    String
    accessLevel     CaregiverAccessLevel
    permissions     Json?
    invitedAt       DateTime            @default(now())
    acceptedAt      DateTime?
    expiresAt       DateTime?
    status          CaregiverAccessStatus @default(PENDING)
    inviteToken     String?               @unique
    patient         Patient             @relation(fields: [patientId], references: [id], onDelete: Cascade)
    caregiver       User                @relation(fields: [caregiverId], references: [id])
    revokedAt       DateTime?
    revokedBy       String?
    @@unique([patientId, caregiverId])
    @@map("caregiver_access")
}

model Notification {
    id              String             @id @default(uuid())
    patientId              String?        @db.Uuid
    doctorId               String?        @db.Uuid
    hspId                  String?        @db.Uuid
    organizationId         String?        @db.Uuid
    type            NotificationType
    title           String
    message         String
    priority        NotificationPriority @default(MEDIUM)
    isUrgent               Boolean?       @default(false)
    channels        NotificationChannel[]
    scheduledFor    DateTime?
    expiresAt       DateTime?
    status                 String?        @default("PENDING") @db.VarChar(20)
    sentAt                 DateTime?
    deliveredAt     DateTime?
    deliveryAttempts       Int?           @default(0)
    deliveryLog            Json?          @default("[]")
    readAt          DateTime?
    acknowledgedAt  DateTime?
    relatedAppointmentId   String?        @db.Uuid
    relatedMedicationId    String?        @db.Uuid
    relatedCarePlanId      String?        @db.Uuid
    relatedTreatmentPlanId String?        @db.Uuid
    metadata               Json?          @default("{}")
    requiresAction         Boolean?       @default(false)
    actionUrl       String?
    actionTaken            Boolean?       @default(false)
    actionTakenAt          DateTime?
    templateId             String?        @db.VarChar(100)
    personalizationData    Json?          @default("{}")
    createdAt       DateTime           @default(now())
    updatedAt              DateTime?      @updatedAt
    deletedAt              DateTime?
    recipientId            String?        @db.Uuid
    doctor                 Doctor?        @relation(fields: [doctorId], references: [id], onDelete: NoAction, onUpdate: NoAction)
    hsp                    Hsp?           @relation(fields: [hspId], references: [id], onDelete: NoAction, onUpdate: NoAction)
    organization           Organization?  @relation(fields: [organizationId], references: [id], onDelete: NoAction, onUpdate: NoAction)
    patient                Patient?       @relation(fields: [patientId], references: [id], onDelete: Cascade, onUpdate: NoAction)
    recipient              User?          @relation(fields: [recipientId], references: [id])
    relatedAppointment     Appointment?   @relation(fields: [relatedAppointmentId], references: [id], onDelete: NoAction, onUpdate: NoAction)
    relatedCarePlan        CarePlan?      @relation(fields: [relatedCarePlanId], references: [id], onDelete: NoAction, onUpdate: NoAction)
    relatedMedication      Medication?    @relation(fields: [relatedMedicationId], references: [id], onDelete: NoAction, onUpdate: NoAction)
    relatedTreatmentPlan   TreatmentPlan? @relation(fields: [relatedTreatmentPlanId], references: [id], onDelete: NoAction, onUpdate: NoAction)
    userId          String
    category        NotificationCategory
    titleHi         String?
    messageHi       String?
    sentVia         Json?
    relatedType     String?
    relatedId       String?
    actionData      Json?
    user            User               @relation(fields: [userId], references: [id], onDelete: Cascade)
    @@index([scheduledFor])
    @@map("notifications")
}

model PatientNotificationPreference {
    id              String          @id @default(uuid())
    patientId       String          @unique
    pushEnabled     Boolean         @default(true)
    emailEnabled    Boolean         @default(true)
    smsEnabled      Boolean         @default(true)
    medicationReminders Boolean     @default(true)
    appointmentReminders Boolean    @default(true)
    vitalReminders  Boolean         @default(true)
    exerciseReminders Boolean       @default(true)
    labResultAlerts         Boolean  @default(true)
    achievementAlerts       Boolean  @default(true)
    careTeamMessages        Boolean  @default(true)
    reminderLeadTime        Int      @default(15) // minutes before
    quietHoursStart String?         // "22:00"
    quietHoursEnd   String?         // "07:00"
    timezone                String   @default("UTC")
    patient         Patient         @relation(fields: [patientId], references: [id], onDelete: Cascade)
    whatsappEnabled Boolean         @default(false)
    quietHoursEnabled Boolean       @default(false)
    criticalAlertsBypass Boolean    @default(true)
    @@map("patient_notification_preferences")
}

model Conversation {
    id              String              @id @default(uuid())
    type            ConversationType
    subject         String?
    status          ConversationStatus  @default(ACTIVE)
    lastMessageAt   DateTime            @default(now())
    relatedType     String?
    relatedId       String?
    createdAt       DateTime            @default(now())
    updatedAt       DateTime            @updatedAt
    participants    ConversationParticipant[]
    messages        Message[]
    @@map("conversations")
    @@index([lastMessageAt])
}

model ConversationParticipant {
    id              String       @id @default(uuid())
    conversationId  String
    userId          String
    role            UserRole
    canSend         Boolean      @default(true)
    canDelete       Boolean      @default(false)
    joinedAt        DateTime     @default(now())
    leftAt          DateTime?
    lastReadAt      DateTime?
    isMuted         Boolean      @default(false)
    conversation    Conversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)
    @@unique([conversationId, userId])
    @@map("conversation_participants")
}

model Message {
    id              String          @id @default(uuid())
    conversationId  String
    senderId        String
    senderRole      UserRole
    content         String
    contentType     MessageContentType @default(TEXT)
    attachments     Json?
    isRead          Boolean         @default(false)
    readAt          DateTime?
    isDeleted       Boolean         @default(false)
    deletedAt       DateTime?
    originalLanguage String?
    translatedContent Json?
    createdAt       DateTime        @default(now())
    conversation    Conversation    @relation(fields: [conversationId], references: [id], onDelete: Cascade)
    sender          User            @relation("MessageSender", fields: [senderId], references: [id])
    @@map("messages")
    @@index([conversationId, createdAt])
}

model Appointment {
    id                  String            @id @default(uuid())
    participantOneType AppointmentParticipantOneType?
    participantOneId   String?                        @db.Uuid
    participantTwoType AppointmentParticipantTwoType?
    participantTwoId   String?                        @db.Uuid
    organizerType      AppointmentOrganizerType?
    organizerId        String?                        @db.Uuid
    providerId          String
    providerName       String?                        @db.VarChar(100)
    description        String?                        @db.VarChar(1000)
    appointmentType    String                         @default("consultation")
    notes               String?
    startDate          DateTime?                      @db.Date
    endDate            DateTime?                      @db.Date
    startTime          DateTime?
    endTime             DateTime
    rrRule             String?                        @db.VarChar(1000)
    details            Json?                          @db.Json
    status              AppointmentStatus @default(SCHEDULED)
    createdAt           DateTime          @default(now())
    updatedAt           DateTime          @updatedAt
    deletedAt          DateTime?
    doctorId           String?                        @db.Uuid
    patientId           String
    slotId             String?                        @db.Uuid
    carePlanId         String?                        @db.Uuid
    doctor             Doctor?                        @relation(fields: [doctorId], references: [id])
    patient             Patient           @relation(fields: [patientId], references: [id])
    provider           User?                          @relation(fields: [providerId], references: [id], onDelete: NoAction, onUpdate: NoAction)
    appointmentSlot    AppointmentSlot?               @relation(fields: [slotId], references: [id])
    carePlan           CarePlan?                      @relation(fields: [carePlanId], references: [id])
    notifications      Notification[]
    videoConsultations VideoConsultation[]
    adherenceLogs      AdherenceLog[]
    providerType        ProviderType
    scheduledAt         DateTime
    duration            Int
    type                AppointmentType
    mode                AppointmentMode
    videoRoomId         String?
    videoRoomUrl        String?
    locationId          String?
    locationName        String?
    locationAddress     String?
    reason              String?
    patientNotes        String?
    preAppointmentChecklist Json?
    checklistCompletedAt    DateTime?
    summary             String?
    followUpRequired    Boolean           @default(false)
    followUpDate        DateTime?
    remindersSent       Json?
    fee                 Decimal?          @db.Decimal(10, 2)
    currency            String            @default("INR")
    paymentStatus       PaymentStatus     @default(PENDING)
    paymentId           String?
    cancelledAt         DateTime?
    cancelledBy         String?
    cancellationReason  String?
    consultationNotes   ConsultationNote[]
    prescriptions       Prescription[]
    @@index([status, scheduledAt])
    @@map("appointments")
}

model CareTeam {
    id              String          @id @default(uuid())
    patientId       String          @unique
    primaryDoctorId String?
    createdAt       DateTime        @default(now())
    updatedAt       DateTime        @updatedAt
    patient         Patient         @relation(fields: [patientId], references: [id], onDelete: Cascade)
    members         CareTeamMember[]
    @@map("care_teams")
}

model CareTeamMember {
    id              String          @id @default(uuid())
    careTeamId      String
    userId          String
    role            UserRole
    specialization  String?
    isPrimary       Boolean         @default(false)
    assignedAt      DateTime        @default(now())
    assignedBy      String?
    isActive        Boolean         @default(true)
    deactivatedAt   DateTime?
    permissions     Json?
    consentStatus   ConsentStatus   @default(PENDING)
    consentedAt     DateTime?
    careTeam        CareTeam        @relation(fields: [careTeamId], references: [id], onDelete: Cascade)
    @@unique([careTeamId, userId])
    @@map("care_team_members")
}

model AuditLog {
    id              String      @id @default(uuid())
    userId          String?
    userRole        UserRole?
    organizationId String?       @db.Uuid
    action          AuditAction
    resource       String        @db.VarChar(500)
    patientId      String?       @db.Uuid
    entityType      String
    entityId        String?
    phiAccessed    Boolean?      @default(false)
    accessGranted  Boolean
    denialReason   String?
    ipAddress       String?
    userAgent       String?
    sessionId       String?
    requestId      String?       @db.Uuid
    dataChanges    Json?
    encryptedData  Json?
    riskLevel      String?       @default("low") @db.VarChar(10)
    securityAlerts Json?         @default("[]")
    retentionDate  DateTime?
    timestamp      DateTime
    createdAt       DateTime    @default(now())
    organization   Organization? @relation(fields: [organizationId], references: [id], onDelete: NoAction, onUpdate: NoAction)
    patient        Patient?      @relation(fields: [patientId], references: [id], onDelete: NoAction, onUpdate: NoAction)
    user            User?       @relation(fields: [userId], references: [id])
    previousData    Json?
    newData         Json?
    changedFields   String[]
    description     String?
    metadata        Json?
    accessReason    String?
    consentId       String?
    @@index([action, createdAt])
    @@map("audit_logs")
}

model PrakritiAssessment {
    id              String          @id @default(uuid())
    patientId       String
    assessedBy      String
    vataScore       Int
    pittaScore      Int
    kaphaScore      Int
    dominantPrakriti PrakritiType
    secondaryPrakriti PrakritiType?
    questionnaire   Json
    physicalExam    Json?
    pulseExam       Json?
    dietRecommendations     String?
    lifestyleRecommendations String?
    seasonalRecommendations String?
    notes           String?
    assessedAt      DateTime        @default(now())
    patient         Patient         @relation(fields: [patientId], references: [id], onDelete: Cascade)
    @@map("prakriti_assessments")
    @@index([patientId])
}

model AyurvedaTreatment {
    id              String          @id @default(uuid())
    patientId       String
    hspId           String
    treatmentPlanId String?
    treatmentType   AyurvedaTreatmentType
    name            String
    nameHi          String?
    panchakarmaPhase PanchakarmaPhase?
    startDate       DateTime
    endDate         DateTime?
    duration        Int?
    medications     Json?
    pathya          String[]
    apathya         String[]
    instructions    String?
    instructionsHi  String?
    status          TreatmentPlanStatus @default(ACTIVE)
    createdAt       DateTime        @default(now())
    updatedAt       DateTime        @updatedAt
    patient         Patient         @relation(fields: [patientId], references: [id])
    hsp             HSP             @relation(fields: [hspId], references: [id])
    sessions        AyurvedaSession[]
    @@map("ayurveda_treatments")
}

model AyurvedaSession {
    id                  String          @id @default(uuid())
    ayurvedaTreatmentId String
    sessionNumber       Int
    scheduledAt         DateTime
    completedAt         DateTime?
    procedure           String
    procedureDetails    Json?
    materialsUsed       Json?
    patientResponse     String?
    complications       String?
    vitalsBeforeSession Json?
    vitalsAfterSession  Json?
    practitionerNotes   String?
    status              SessionStatus   @default(SCHEDULED)
    ayurvedaTreatment   AyurvedaTreatment @relation(fields: [ayurvedaTreatmentId], references: [id], onDelete: Cascade)
    @@map("ayurveda_sessions")
}

model YogaTherapy {
    id              String          @id @default(uuid())
    patientId       String
    hspId           String
    treatmentPlanId String?
    therapeuticGoals String[]
    programName     String
    programNameHi   String?
    description     String?
    frequency       String
    duration        Int
    totalWeeks      Int?
    asanas          Json
    pranayama       Json?
    meditation      Json?
    relaxation      Json?
    precautions     String[]
    contraindications String[]
    status          TreatmentPlanStatus @default(ACTIVE)
    startDate       DateTime
    endDate         DateTime?
    createdAt       DateTime        @default(now())
    updatedAt       DateTime        @updatedAt
    patient         Patient         @relation(fields: [patientId], references: [id])
    hsp             HSP             @relation(fields: [hspId], references: [id])
    sessions        YogaSession[]
    @@map("yoga_therapies")
}

model YogaSession {
    id              String          @id @default(uuid())
    yogaTherapyId   String
    scheduledAt     DateTime
    completedAt     DateTime?
    duration        Int?
    asanasCompleted Json?
    pranayamaCompleted Json?
    meditationDuration Int?
    heartRateBefore Int?
    heartRateAfter  Int?
    stressLevelBefore Int?
    stressLevelAfter Int?
    difficultyLevel Int?
    painLevel       Int?
    mood            String?
    notes           String?
    status          SessionStatus   @default(SCHEDULED)
    yogaTherapy     YogaTherapy     @relation(fields: [yogaTherapyId], references: [id], onDelete: Cascade)
    @@map("yoga_sessions")
}

model HomeopathyCase {
    id              String          @id @default(uuid())
    patientId       String
    hspId           String
    chiefComplaint  String
    chiefComplaintHi String?
    mentalSymptoms  Json
    physicalSymptoms Json
    generalSymptoms Json
    constitutionalType String?
    miasm           String?
    repertorizationResults Json?
    remedy          String?
    potency         String?
    dosageSchedule  String?
    status          CaseStatus      @default(ACTIVE)
    createdAt       DateTime        @default(now())
    updatedAt       DateTime        @updatedAt
    patient         Patient         @relation(fields: [patientId], references: [id])
    hsp             HSP             @relation(fields: [hspId], references: [id])
    followUps       HomeopathyFollowUp[]
    @@map("homeopathy_cases")
}

model HomeopathyFollowUp {
    id                  String          @id @default(uuid())
    homeopathyCaseId    String
    followUpDate        DateTime
    overallProgress     ProgressDirection
    symptomChanges      Json
    newSymptoms         String[]
    healingDirection    String?
    remedyChanged       Boolean         @default(false)
    newRemedy           String?
    newPotency          String?
    practitionerNotes   String?
    homeopathyCase      HomeopathyCase  @relation(fields: [homeopathyCaseId], references: [id], onDelete: Cascade)
    @@map("homeopathy_follow_ups")
}

model ABDMHealthRecord {
    id                  String          @id @default(uuid())
    patientId           String
    abhaId              String
    healthRecordId      String          @unique
    recordType          ABDMRecordType
    fhirBundle          Json
    hipId               String
    hipName             String?
    recordDate          DateTime
    linkedAt            DateTime        @default(now())
    consentId           String
    consentExpiresAt    DateTime
    patient             Patient         @relation(fields: [patientId], references: [id], onDelete: Cascade)
    @@map("abdm_health_records")
    @@index([abhaId])
}

model ABDMConsent {
    id                  String          @id @default(uuid())
    patientId           String
    consentId           String          @unique
    consentStatus       ABDMConsentStatus
    purpose             String
    purposeDescription  String?
    hiTypes             String[]
    requesterHiuId      String
    requesterName       String
    dateRangeFrom       DateTime
    dateRangeTo         DateTime
    consentExpiresAt    DateTime
    requestedAt         DateTime        @default(now())
    grantedAt           DateTime?
    revokedAt           DateTime?
    patient             Patient         @relation(fields: [patientId], references: [id], onDelete: Cascade)
    @@map("abdm_consents")
    @@index([patientId, consentStatus])
}

model Translation {
    id              String          @id @default(uuid())
    key             String
    namespace       String
    en              String
    hi              String?
    ta              String?
    te              String?
    bn              String?
    mr              String?
    gu              String?
    kn              String?
    ml              String?
    pa              String?
    or              String?
    as              String?
    ur              String?
    context         String?
    maxLength       Int?
    isVerified      Boolean         @default(false)
    lastUpdated     DateTime        @default(now())
    updatedBy       String?
    @@unique([key, namespace])
    @@map("translations")
    @@index([namespace])
}

model MedicalTermTranslation {
    id              String          @id @default(uuid())
    termEn          String
    termType        MedicalTermType
    termHi          String?
    termTa          String?
    termTe          String?
    termBn          String?
    termMr          String?
    pronunciationHi String?
    simpleExplanationEn String?
    simpleExplanationHi String?
    snomedCode      String?
    icdCode         String?
    isVerified      Boolean         @default(false)
    @@unique([termEn, termType])
    @@map("medical_term_translations")
}

model PatientRiskScore {
    id              String   @id @default(uuid())
    patientId       String
    doctorId        String
    overallRisk     Int
    adherenceRisk   Int
    clinicalRisk    Int
    hospitalizationRisk Int?
    riskFactors     Json
    calculatedAt    DateTime @default(now())
    algorithm       String   @default("v1")
    manualOverride  Boolean  @default(false)
    overrideReason  String?
    overrideBy      String?
    overrideAt      DateTime?
    patient         Patient  @relation(fields: [patientId], references: [id], onDelete: Cascade)
    doctor          Doctor   @relation(fields: [doctorId], references: [id])
    @@map("patient_risk_scores")
    @@index([patientId])
    @@index([doctorId, overallRisk])
}

model Organization {
    id                              String                          @id @default(uuid()) @db.Uuid
    name                            String                          @db.VarChar(255)
    type                            String?                         @default("clinic") @db.VarChar(100)
    licenseNumber                   String?                         @unique @db.VarChar(100)
    contactInfo                     Json?                           @default("{}")
    address                         Json?                           @default("{}")
    settings                        Json?                           @default("{\"timezone\": \"UTC\", \"working_hours\": {\"friday\": {\"end\": \"17:00\", \"start\": \"09:00\"}, \"monday\": {\"end\": \"17:00\", \"start\": \"09:00\"}, \"sunday\": {\"closed\": true}, \"tuesday\": {\"end\": \"17:00\", \"start\": \"09:00\"}, \"saturday\": {\"end\": \"13:00\", \"start\": \"09:00\"}, \"thursday\": {\"end\": \"17:00\", \"start\": \"09:00\"}, \"wednesday\": {\"end\": \"17:00\", \"start\": \"09:00\"}}, \"notification_preferences\": {\"sms_enabled\": false, \"push_enabled\": true, \"email_enabled\": true}}")
    isActive                        Boolean?                        @default(true)
    hipaaCoveredEntity              Boolean?                        @default(true)
    businessAssociateAgreement      Json?
    createdAt                       DateTime?                       @db.Timestamptz(6)
    updatedAt                       DateTime?                       @updatedAt @db.Timestamptz(6)
    deletedAt                       DateTime?                       @db.Timestamptz(6)
    auditLogs                       AuditLog[]
    carePlanTemplates               CarePlanTemplate[]
    carePlans                       CarePlan[]
    clinics                         Clinic[]
    doctors                         Doctor[]
    healthcareProviders             HealthcareProvider[]
    hsps                            Hsp[]
    notifications                   Notification[]
    newPatientProviderConsents      PatientProviderConsentHistory[] @relation("NewProviderConsents")
    previousPatientProviderConsents PatientProviderConsentHistory[] @relation("PreviousProviderConsents")
    linkedPatients                  Patient[]                       @relation("patients_linked_provider_idToorganizations")
    patients                        Patient[]
    newProviderChanges              ProviderChange[]                @relation("NewProviderChanges")
    previousProviderChanges         ProviderChange[]                @relation("PreviousProviderChanges")
    primaryDoctorAssignments        SecondaryDoctorAssignment[]     @relation("PrimaryDoctorProviderAssignments")
    secondaryDoctorAssignments      SecondaryDoctorAssignment[]     @relation("SecondaryDoctorProviderAssignments")
    treatmentPlans                  TreatmentPlan[]
    prescriptions                   Prescription[]
    adherenceLogs                   AdherenceLog[]
    medicalDevices                  MedicalDevice[]
    @@index([isActive], map: "organizations_is_active")
    @@index([name], map: "organizations_name")
    @@index([type], map: "organizations_type")
    @@map("organizations")
}

model Account {
    id                String    @id @default(cuid())
    userId            String    @db.Uuid
    type              String
    provider          String
    providerAccountId String
    refreshToken      String?   @db.Text
    accessToken       String?   @db.Text
    expiresAt         Int?
    tokenType         String?
    scope             String?
    idToken           String?   @db.Text
    sessionState      String?
    providerEmail     String?   @db.VarChar(255)
    providerName      String?   @db.VarChar(255)
    linkedAt          DateTime  @default(now()) @db.Timestamptz(6)
    lastUsedAt        DateTime? @db.Timestamptz(6)
    user              User      @relation(fields: [userId], references: [id], onDelete: Cascade)
    @@unique([provider, providerAccountId])
    @@index([userId, provider])
    @@map("accounts")
}

model Session {
    id                String    @id @default(cuid())
    sessionToken      String    @unique
    userId            String    @db.Uuid
    expires           DateTime
    ipAddress         String?   @db.VarChar(45)
    userAgent         String?   @db.Text
    createdAt         DateTime  @default(now()) @db.Timestamptz(6)
    lastAccessedAt    DateTime? @updatedAt @db.Timestamptz(6)
    healthcareContext Json?     @default("{}")
    user              User      @relation(fields: [userId], references: [id], onDelete: Cascade)
    @@index([userId], map: "sessions_user_id")
    @@index([expires], map: "sessions_expires")
    @@index([ipAddress], map: "sessions_ip_address")
    @@map("sessions")
}

model VerificationToken {
    identifier String
    token      String   @unique
    expires    DateTime
    @@unique([identifier, token])
    @@map("verificationTokens")
}

model AccountLink {
    id                String    @id @default(uuid()) @db.Uuid
    userId            String    @db.Uuid
    provider          String    @db.VarChar(50)
    providerAccountId String    @db.VarChar(255)
    providerEmail     String?   @db.VarChar(255)
    linkedAt          DateTime  @default(now()) @db.Timestamptz(6)
    lastUsedAt        DateTime? @db.Timestamptz(6)
    isPrimary         Boolean   @default(false)
    metadata          Json?     @default("{}")
    user              User      @relation(fields: [userId], references: [id], onDelete: Cascade)
    @@unique([userId, provider], map: "account_links_user_provider")
    @@unique([provider, providerAccountId], map: "account_links_provider_account")
    @@index([userId], map: "account_links_user_id")
    @@index([provider], map: "account_links_provider")
    @@map("accountLinks")
}

model HealthcareProvider {
    id                         String                      @id @default(uuid()) @db.Uuid
    userId                     String                      @unique @db.Uuid
    organizationId             String?                     @db.Uuid
    licenseNumber              String?                     @unique @db.VarChar(100)
    specialties                String[]                    @default([])
    subSpecialties             String[]                    @default([])
    qualifications             Json?                       @default("[]")
    yearsOfExperience          Int?
    isVerified                 Boolean?                    @default(false)
    verificationDocuments      Json?                       @default("[]")
    verificationDate           DateTime?                   @db.Timestamptz(6)
    verifiedBy                 String?                     @db.Uuid
    consultationFee            Decimal?                    @db.Decimal(10, 2)
    availabilitySchedule       Json?                       @default("{\"friday\": {\"end\": \"17:00\", \"start\": \"09:00\", \"available\": true}, \"monday\": {\"end\": \"17:00\", \"start\": \"09:00\", \"available\": true}, \"sunday\": {\"available\": false}, \"tuesday\": {\"end\": \"17:00\", \"start\": \"09:00\", \"available\": true}, \"saturday\": {\"available\": false}, \"thursday\": {\"end\": \"17:00\", \"start\": \"09:00\", \"available\": true}, \"wednesday\": {\"end\": \"17:00\", \"start\": \"09:00\", \"available\": true}}")
    notificationPreferences    Json?                       @default("{\"patient_updates\": true, \"marketing_emails\": false, \"smsNotifications\": true, \"pushNotifications\": true, \"system_notifications\": true, \"appointmentReminders\": true}")
    practiceName               String?                     @db.VarChar(255)
    practiceAddress            Json?                       @default("{}")
    practicePhone              String?                     @db.VarChar(20)
    practiceWebsite            String?                     @db.VarChar(255)
    totalPatients              Int?                        @default(0)
    activeCarePlans            Int?                        @default(0)
    averageRating              Decimal?                    @db.Decimal(3, 2)
    totalReviews               Int?                        @default(0)
    createdAt                  DateTime?                   @db.Timestamptz(6)
    updatedAt                  DateTime?                   @updatedAt @db.Timestamptz(6)
    deletedAt                  DateTime?                   @db.Timestamptz(6)
    carePlanTemplates          CarePlanTemplate[]
    organization               Organization?               @relation(fields: [organizationId], references: [id], onDelete: NoAction, onUpdate: NoAction)
    user                       User                        @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: NoAction)
    verifier                   User?                       @relation("UserVerifiedHealthcareProviders", fields: [verifiedBy], references: [id], onDelete: NoAction, onUpdate: NoAction)
    patientProviderAssignments PatientProviderAssignment[]
    patientSubscriptions       PatientSubscription[]
    payments                   Payment[]
    servicePlans               ServicePlan[]
    vitalReadings              VitalReading[]
    @@index([isVerified])
    @@index([organizationId])
    @@index([specialties], type: Gin)
    @@index([verificationDate])
    @@index([organizationId, isVerified], map: "idx_providers_org_verified")
    @@map("healthcareProviders")
}

model Specialty {
    id          Int       @id @default(autoincrement())
    name        String    @unique @db.VarChar(255)
    description String?   @db.VarChar(1000)
    userCreated Int?
    createdAt   DateTime? @db.Timestamptz(6)
    updatedAt   DateTime? @updatedAt @db.Timestamptz(6)
    deletedAt   DateTime?
    doctors     Doctor[]
    @@map("specialties")
}

model Clinic {
    id                 String        @id @default(uuid()) @db.Uuid
    name               String        @db.VarChar(255)
    doctorId           String        @db.Uuid
    organizationId     String?       @db.Uuid
    address            Json          @default("{}")
    latitude           Decimal?      @db.Decimal(10, 8)
    longitude          Decimal?      @db.Decimal(11, 8)
    locationVerified   Boolean?      @default(false)
    locationAccuracy   String?       @db.VarChar(20)
    phone              String?       @db.VarChar(20)
    email              String?       @db.VarChar(255)
    website            String?       @db.VarChar(500)
    operatingHours     Json          @default("{}")
    servicesOffered    String[]      @default([])
    clinicImages       Json?         @default("[]")
    bannerImage        String?
    description        String?
    consultationFee    Decimal?      @db.Decimal(10, 2)
    isPrimary          Boolean       @default(false)
    isActive           Boolean       @default(true)
    registrationNumber String?       @db.VarChar(100)
    establishedYear    Int?
    facilities         Json?         @default("[]")
    insuranceAccepted  String[]      @default([])
    createdAt          DateTime?     @db.Timestamptz(6)
    updatedAt          DateTime?     @updatedAt @db.Timestamptz(6)
    deletedAt          DateTime?     @db.Timestamptz(6)
    doctor             Doctor        @relation(fields: [doctorId], references: [id], onDelete: Cascade)
    organization       Organization? @relation(fields: [organizationId], references: [id], onDelete: NoAction, onUpdate: NoAction)
    @@index([doctorId])
    @@index([isActive])
    @@index([isPrimary])
    @@index([organizationId])
    @@index([latitude, longitude], map: "idx_clinics_coordinates")
    @@index([locationVerified], map: "idx_clinics_location_verified")
    @@map("clinics")
}

model DietPlan {
    id              String     @id @default(uuid())
    name            String
    description     String?
    type          String?              @db.VarChar(100)
    totalCalories Decimal?             @map("total_calories") @db.Decimal(6, 2) // Range: 0.00 - 9999.99 calories
    startDate       DateTime
    endDate         DateTime?
    details       Json?
    expiredOn     DateTime?            @map("expired_on") @db.Date
    isActive        Boolean    @default(true)
    createdAt       DateTime   @default(now())
    updatedAt       DateTime   @updatedAt
    deletedAt     DateTime?            @map("deleted_at")
    carePlans     CarePlanToDietPlan[]
    patientId       String
    patient         Patient    @relation(fields: [patientId], references: [id], onDelete: Cascade)
    meals           MealPlan[]
    mealLogs        MealLog[]
    carePlanId      String?
    targetCalories  Int?
    targetProtein   Int?       // grams
    targetCarbs     Int?       // grams
    targetFat       Int?       // grams
    targetFiber     Int?       // grams
    targetWater     Int?       // ml
    restrictions    String[]   // e.g., ["gluten-free", "low-sodium"]
    createdBy       String
    carePlan        CarePlan?  @relation(fields: [carePlanId], references: [id])
    @@index([patientId])
    @@map("diet_plans")
}

model WorkoutPlan {
    id             String                  @id @default(uuid()) @db.Uuid
    name           String                  @unique @db.VarChar(255)
    description    String?
    type           String?                 @db.VarChar(100)
    caloriesBurned Decimal?                @map("calories_burned") @db.Decimal(6, 2) // Range: 0.00 - 9999.99 calories burned
    startDate      DateTime?               @map("start_date") @db.Date
    endDate        DateTime?               @map("end_date") @db.Date
    time           DateTime?               @map("time")
    details        Json?
    expiredOn      DateTime?               @map("expired_on") @db.Date
    isActive       Boolean                 @default(true) @map("is_active")
    createdAt      DateTime                @default(now()) @map("created_at")
    updatedAt      DateTime                @updatedAt @map("updated_at")
    deletedAt      DateTime?               @map("deleted_at")
    carePlans      CarePlanToWorkoutPlan[]
    patientId      String?   @db.Uuid
    patient        Patient?  @relation(fields: [patientId], references: [id], onDelete: Cascade)
    @@index([type])
    @@index([patientId])
    @@map("WorkoutPlan")
}

model CarePlanToDietPlan {
    carePlan   CarePlan @relation(fields: [carePlanId], references: [id])
    carePlanId String   @db.Uuid
    dietPlan   DietPlan @relation(fields: [dietPlanId], references: [id])
    dietPlanId String   @db.Uuid
    assignedAt DateTime @default(now())
    assignedBy String
    @@id([carePlanId, dietPlanId])
}

model CarePlanToWorkoutPlan {
    carePlan      CarePlan    @relation(fields: [carePlanId], references: [id])
    carePlanId    String      @db.Uuid
    workoutPlan   WorkoutPlan @relation(fields: [workoutPlanId], references: [id])
    workoutPlanId String      @db.Uuid
    assignedAt    DateTime    @default(now())
    assignedBy    String
    @@id([carePlanId, workoutPlanId])
}

model Report {
    id         String    @id @default(uuid()) @db.Uuid
    patientId  String    @db.Uuid
    carePlanId String?   @db.Uuid
    name       String
    url        String
    createdAt  DateTime  @default(now())
    patient    Patient   @relation(fields: [patientId], references: [id], onDelete: Cascade)
    carePlan   CarePlan? @relation(fields: [carePlanId], references: [id])
}

model Medication {
    id             String                   @id @default(uuid()) @db.Uuid
    participantId  String                   @db.Uuid
    organizerType  MedicationOrganizerType?
    organizerId    String                   @db.Uuid
    medicineId     String                   @db.Uuid
    description    String?                  @db.VarChar(1000)
    startDate      DateTime?
    endDate        DateTime?
    rrRule         String?                  @db.VarChar(1000)
    details        Json?                    @db.Json
    createdAt      DateTime
    updatedAt      DateTime                 @updatedAt
    deletedAt      DateTime?
    carePlanId     String?                  @db.Uuid
    medicationLogs MedicationLog[]
    carePlan       CarePlan?                @relation("prescribed_medications", fields: [carePlanId], references: [id])
    medicine       Medicine                 @relation(fields: [medicineId], references: [id], onDelete: NoAction)
    notifications  Notification[]
    safetyAlerts   MedicationSafetyAlert[]
    adherenceLogs  AdherenceLog[]
    refillRequests RefillRequest[]
    @@index([medicineId])
    @@index([organizerType, organizerId])
    @@index([participantId])
    @@map("medications")
}

model Symptom {
    id                 String    @id @default(uuid()) @db.Uuid
    patientId          String    @db.Uuid
    carePlanId         String?   @db.Uuid
    symptomName        String    @db.VarChar(255)
    severity           Int?
    description        String?
    bodyLocation       Json?     @default("{}")
    onsetTime          DateTime?
    recordedAt         DateTime?
    triggers           Json?     @default("[]")
    relievingFactors   Json?     @default("[]")
    associatedSymptoms Json?     @default("[]")
    attachments        Json?     @default("[]")
    createdAt          DateTime?
    updatedAt          DateTime? @updatedAt
    deletedAt          DateTime?
    carePlan           CarePlan? @relation(fields: [carePlanId], references: [id], onDelete: NoAction, onUpdate: NoAction)
    patient            Patient   @relation(fields: [patientId], references: [id], onDelete: NoAction, onUpdate: NoAction)
    @@index([patientId, onsetTime, severity], map: "idx_symptoms_patient_onset_severity")
    @@index([carePlanId])
    @@index([onsetTime])
    @@index([patientId])
    @@index([patientId, recordedAt], map: "symptoms_patient_id_recorded_at")
    @@index([recordedAt])
    @@index([severity])
    @@index([symptomName])
    @@map("symptoms")
}

model AdherenceRecord {
    id               String          @id @default(uuid()) @db.Uuid
    patientId        String          @db.Uuid
    scheduledEventId String?         @db.Uuid
    adherenceType    AdherenceType
    dueAt            DateTime
    recordedAt       DateTime?
    isCompleted      Boolean?        @default(false)
    isPartial        Boolean?        @default(false)
    isMissed         Boolean?        @default(false)
    responseData     Json?           @default("{}")
    notes            String?
    attachments      Json?           @default("[]")
    createdAt        DateTime?
    updatedAt        DateTime?       @updatedAt
    deletedAt        DateTime?
    patient          Patient         @relation(fields: [patientId], references: [id], onDelete: NoAction, onUpdate: NoAction)
    scheduledEvent   ScheduledEvent? @relation(fields: [scheduledEventId], references: [id], onDelete: NoAction, onUpdate: NoAction)
    vitalReadings    VitalReading[]
    @@index([adherenceType])
    @@index([dueAt])
    @@index([isCompleted, isMissed])
    @@index([patientId])
    @@index([patientId, adherenceType, dueAt])
    @@index([patientId, dueAt])
    @@index([scheduledEventId])
    @@index([scheduledEventId, isCompleted, recordedAt], map: "idx_adherence_event_status_completed")
    @@index([patientId, dueAt, isCompleted], map: "idx_adherence_patient_due_status")
    @@map("adherenceRecords")
}

model ServicePlan {
    id                   String                  @id @default(uuid()) @db.Uuid
    providerId           String                  @db.Uuid
    name                 String                  @db.VarChar(255)
    description          String?
    serviceType          String?                 @db.VarChar(100)
    price                Decimal                 @db.Decimal(10, 2)
    currency             String?                 @default("USD") @db.VarChar(3)
    billingCycle         ServicePlanBillingCycle @default(MONTHLY)
    features             Json?                   @default("[]") @db.Json
    patientLimit         Int?
    trialPeriodDays      Int?                    @default(0)
    setupFee             Decimal?                @default(0) @db.Decimal(10, 2)
    isActive             Boolean?                @default(true)
    stripePriceId        String?                 @db.VarChar(255)
    createdAt            DateTime
    updatedAt            DateTime                @updatedAt
    deletedAt            DateTime?
    patientSubscriptions PatientSubscription[]
    healthcareProvider   HealthcareProvider      @relation(fields: [providerId], references: [id], onDelete: Cascade)
    @@index([billingCycle])
    @@index([isActive])
    @@index([name])
    @@index([price])
    @@index([providerId])
    @@index([serviceType])
    @@map("servicePlans")
}

model PatientSubscription {
    id                   String                     @id @default(uuid()) @db.Uuid
    patientId            String                     @db.Uuid
    providerId           String                     @db.Uuid
    servicePlanId        String                     @db.Uuid
    status               PatientSubscriptionStatus? @default(ACTIVE)
    currentPeriodStart   DateTime                   @db.Date
    currentPeriodEnd     DateTime                   @db.Date
    nextBillingDate      DateTime?                  @db.Date
    trialStart           DateTime?                  @db.Date
    trialEnd             DateTime?                  @db.Date
    paymentMethodId      String?                    @db.VarChar(255)
    stripeSubscriptionId String?                    @unique @db.VarChar(255)
    stripeCustomerId     String?                    @db.VarChar(255)
    lastPaymentDate      DateTime?
    lastPaymentAmount    Decimal?                   @db.Decimal(10, 2)
    failureCount         Int?                       @default(0)
    metadata             Json?                      @default("{}") @db.Json
    createdAt            DateTime
    updatedAt            DateTime                   @updatedAt
    cancelledAt          DateTime?
    deletedAt            DateTime?
    patient              Patient                    @relation(fields: [patientId], references: [id], onDelete: Cascade)
    healthcareProvider   HealthcareProvider         @relation(fields: [providerId], references: [id], onDelete: NoAction, onUpdate: NoAction)
    servicePlan          ServicePlan                @relation(fields: [servicePlanId], references: [id], onDelete: NoAction, onUpdate: NoAction)
    payments             Payment[]
    @@index([nextBillingDate])
    @@index([patientId])
    @@index([patientId, providerId])
    @@index([providerId])
    @@index([servicePlanId])
    @@index([status])
    @@index([stripeCustomerId])
    @@index([stripeSubscriptionId])
    @@map("patientSubscriptions")
}

model UserDevice {
    id                   String    @id @default(uuid()) @db.Uuid
    userId               String    @db.Uuid
    deviceType           String    @db.VarChar(50)
    pushToken            String    @db.VarChar(500)
    deviceId             String?   @db.VarChar(255)
    isActive             Boolean?  @default(true)
    notificationSettings Json?     @default("{\"vitals\": true, \"symptoms\": true, \"emergency\": true, \"reminders\": true, \"medications\": true, \"appointments\": true}")
    lastUsedAt           DateTime?
    createdAt            DateTime?
    updatedAt            DateTime? @updatedAt
    deletedAt            DateTime?
    user                 User      @relation(fields: [userId], references: [id], onDelete: NoAction, onUpdate: NoAction)
    @@unique([userId, pushToken])
    @@index([deviceType])
    @@index([isActive])
    @@index([lastUsedAt])
    @@index([pushToken])
    @@index([userId])
    @@map("userDevices")
}

model SequelizeMeta {
    name String @id @db.VarChar(255)
    @@map("sequelizeMeta")
}

model AppointmentSlot {
    id                 String               @id @default(uuid()) @db.Uuid
    doctorId           String               @db.Uuid
    date               DateTime             @db.Date
    startTime          DateTime             @db.Time(6)
    endTime            DateTime             @db.Time(6)
    maxAppointments    Int?                 @default(1)
    bookedAppointments Int?                 @default(0)
    isAvailable        Boolean?             @default(true)
    slotType           AppointmentSlotType? @default(REGULAR)
    notes              String?
    createdAt          DateTime
    updatedAt          DateTime             @updatedAt
    deletedAt          DateTime?
    doctor             User                 @relation(fields: [doctorId], references: [id], onDelete: NoAction, onUpdate: NoAction)
    appointments       Appointment[]
    @@index([date, isAvailable])
    @@index([doctorId, date, startTime])
    @@index([doctorId, isAvailable])
    @@map("appointmentSlots")
}

model CarePlanTemplate {
    id               String             @id @db.Uuid
    name             String             @db.VarChar(255)
    description      String?
    conditions       String[]           @default([])
    specialties      String[]           @default([])
    tags             String[]           @default([])
    templateData     Json               @default("{}")
    createdBy        String             @db.Uuid
    organizationId   String?            @db.Uuid
    isPublic         Boolean?           @default(false)
    isApproved       Boolean?           @default(false)
    approvedBy       String?            @db.Uuid
    version          String?            @default("1.0") @db.VarChar(20)
    parentTemplateId String?            @db.Uuid
    usageCount       Int?               @default(0)
    createdAt        DateTime
    updatedAt        DateTime           @updatedAt
    deletedAt        DateTime?
    approvedByUser   User?              @relation(fields: [approvedBy], references: [id], onDelete: NoAction, onUpdate: NoAction)
    createdByUser    HealthcareProvider @relation(fields: [createdBy], references: [id], onDelete: NoAction, onUpdate: NoAction)
    organization     Organization?      @relation(fields: [organizationId], references: [id], onDelete: NoAction, onUpdate: NoAction)
    parentTemplate   CarePlanTemplate?  @relation("CarePlanTemplateToParent", fields: [parentTemplateId], references: [id], onDelete: NoAction, onUpdate: NoAction)
    childTemplates   CarePlanTemplate[] @relation("CarePlanTemplateToParent")
    @@index([conditions], type: Gin)
    @@index([createdBy])
    @@index([isApproved])
    @@index([isPublic])
    @@index([name])
    @@index([organizationId])
    @@index([specialties], type: Gin)
    @@index([tags], type: Gin)
    @@map("carePlanTemplates")
}

model DashboardMetric {
    id           String                     @id @db.Uuid
    entityType   DashboardMetricsEntityType
    entityId     String                     @db.Uuid
    metricType   String                     @db.VarChar(100)
    metricData   Json                       @default("{}")
    calculatedAt DateTime
    validUntil   DateTime?
    createdAt    DateTime?
    updatedAt    DateTime?
    @@unique([entityType, entityId, metricType])
    @@index([calculatedAt, validUntil])
    @@map("dashboardMetrics")
}

model Hsp {
    id                              String                          @id @default(uuid()) @db.Uuid
    userId                          String                          @unique @db.Uuid
    hspId                           String                          @unique @db.VarChar(50)
    organizationId                  String?                         @db.Uuid
    hspType                         String                          @db.VarChar(50)
    licenseNumber                   String?                         @unique @db.VarChar(100)
    certificationNumber             String?                         @db.VarChar(100)
    certifications                  String[]                        @default([])
    education                       Json?                           @default("[]")
    specializations                 String[]                        @default([])
    yearsOfExperience               Int?
    capabilities                    String[]                        @default(["monitor_vitals", "patient_education", "care_coordination"])
    requiresSupervision             Boolean?                        @default(true)
    supervisingDoctorId             String?                         @db.Uuid
    supervisionLevel                String?                         @default("direct") @db.VarChar(20)
    isVerified                      Boolean?                        @default(false)
    verificationDocuments           Json?                           @default("[]")
    verificationDate                DateTime?
    verifiedBy                      String?                         @db.Uuid
    hourlyRate                      Decimal?                        @db.Decimal(8, 2)
    availabilitySchedule            Json?                           @default("{\"friday\": {\"end\": \"18:00\", \"start\": \"08:00\", \"available\": true}, \"monday\": {\"end\": \"18:00\", \"start\": \"08:00\", \"available\": true}, \"sunday\": {\"available\": false}, \"tuesday\": {\"end\": \"18:00\", \"start\": \"08:00\", \"available\": true}, \"saturday\": {\"available\": false}, \"thursday\": {\"end\": \"18:00\", \"start\": \"08:00\", \"available\": true}, \"wednesday\": {\"end\": \"18:00\", \"start\": \"08:00\", \"available\": true}}")
    languagesSpoken                 String[]                        @default(["en"])
    notificationPreferences         Json?                           @default("{\"patient_updates\": true, \"shift_reminders\": true, \"emergency_alerts\": true, \"system_notifications\": true}")
    departments                     String[]                        @default([])
    shiftPreferences                Json?                           @default("{\"preferred_shifts\": [\"day\"], \"weekend_availability\": false, \"night_shift_available\": false}")
    totalPatientsAssisted           Int?                            @default(0)
    activeCarePlans                 Int?                            @default(0)
    tasksCompleted                  Int?                            @default(0)
    averageRating                   Decimal?                        @db.Decimal(3, 2)
    totalReviews                    Int?                            @default(0)
    isAvailable                     Boolean?                        @default(true)
    isActive                        Boolean?                        @default(true)
    createdAt                       DateTime?
    updatedAt                       DateTime?
    deletedAt                       DateTime?
    carePlans                       CarePlan[]
    assignedCarePlans               CarePlan[]                      @relation("AssignedHspCarePlans")
    organization                    Organization?                   @relation(fields: [organizationId], references: [id], onDelete: NoAction, onUpdate: NoAction)
    supervisingDoctor               Doctor?                         @relation(fields: [supervisingDoctorId], references: [id], onDelete: NoAction, onUpdate: NoAction)
    user                            User                            @relation("UserHspProfile", fields: [userId], references: [id], onDelete: Cascade, onUpdate: NoAction)
    verifier                        User?                           @relation("UserVerifiedHsps", fields: [verifiedBy], references: [id], onDelete: NoAction, onUpdate: NoAction)
    notifications                   Notification[]
    patientConsentOtps              PatientConsentOtp[]
    patientProviderConsentHistories PatientProviderConsentHistory[]
    patients                        Patient[]
    secondaryDoctorAssignments      SecondaryDoctorAssignment[]
    secondaryHspAssignments         PatientDoctorAssignment[]       @relation("SecondaryHspAssignments")
    prescriptions                   Prescription[]
    @@index([departments], type: Gin)
    @@index([hspType])
    @@index([isVerified])
    @@index([organizationId])
    @@index([specializations], type: Gin)
    @@index([supervisingDoctorId])
    @@map("hsps")
}

model PatientAlert {
    id             String                @id @db.Uuid
    patientId      String                @db.Uuid
    alertType      PatientAlertType
    severity       PatientAlertSeverity? @default(MEDIUM)
    title          String                @db.VarChar(200)
    message        String
    actionRequired Boolean?              @default(false)
    acknowledged   Boolean?              @default(false)
    acknowledgedAt DateTime?
    acknowledgedBy String?               @db.Uuid
    resolved       Boolean?              @default(false)
    resolvedAt     DateTime?
    metadata       Json?                 @default("{}")
    createdAt      DateTime?
    updatedAt      DateTime?
    patient        Patient               @relation(fields: [patientId], references: [id], onDelete: NoAction)
    @@index([acknowledged, resolved])
    @@index([createdAt])
    @@index([patientId, alertType, severity])
    @@map("patientAlerts")
}

model PatientConsentOtp {
    id                        String                    @id @db.Uuid
    secondaryAssignmentId     String                    @db.Uuid
    patientDoctorAssignmentId String?                   @db.Uuid
    patientId                 String                    @db.Uuid
    primaryDoctorId           String                    @db.Uuid
    secondaryDoctorId         String?                   @db.Uuid
    secondaryHspId            String?                   @db.Uuid
    otpCode                   String                    @db.VarChar(10)
    otpMethod                 PatientConsentOtpMethod?  @default(BOTH)
    consentMethod             String?                   @db.VarChar(50)
    patientPhone              String?                   @db.VarChar(20)
    patientEmail              String?                   @db.VarChar(255)
    generatedAt               DateTime?
    expiresAt                 DateTime
    attemptsCount             Int?                      @default(0)
    verificationAttempts      Int?                      @default(0)
    maxAttempts               Int?                      @default(3)
    isVerified                Boolean?                  @default(false)
    verifiedAt                DateTime?
    verifiedBy                String?                   @db.Uuid
    verificationMethod        String?                   @db.VarChar(50)
    isExpired                 Boolean?                  @default(false)
    isBlocked                 Boolean?                  @default(false)
    blockedAt                 DateTime?
    requestedByUserId         String                    @db.Uuid
    requestIpAddress          String?                   @db.Inet
    requestUserAgent          String?
    smsSent                   Boolean?                  @default(false)
    smsSentAt                 DateTime?
    smsError                  String?
    emailSent                 Boolean?                  @default(false)
    emailSentAt               DateTime?
    emailError                String?
    customMessage             String?
    notes                     String?
    createdAt                 DateTime?
    updatedAt                 DateTime?
    deletedAt                 DateTime?
    patient                   Patient                   @relation(fields: [patientId], references: [id], onDelete: Cascade)
    primaryDoctor             Doctor                    @relation("PrimaryDoctorPatientConsentOtps", fields: [primaryDoctorId], references: [id], onDelete: Cascade)
    requestedByUser           User                      @relation("RequestedByUser", fields: [requestedByUserId], references: [id], onDelete: Cascade)
    verifiedByUser            User?                     @relation("VerifiedByUser", fields: [verifiedBy], references: [id], onDelete: NoAction, onUpdate: NoAction)
    secondaryDoctorAssignment SecondaryDoctorAssignment @relation(fields: [secondaryAssignmentId], references: [id], onDelete: Cascade)
    patientDoctorAssignment   PatientDoctorAssignment?  @relation("PatientDoctorAssignmentOtps", fields: [patientDoctorAssignmentId], references: [id], onDelete: Cascade)
    secondaryDoctor           Doctor?                   @relation("SecondaryDoctorPatientConsentOtps", fields: [secondaryDoctorId], references: [id], onDelete: Cascade)
    secondaryHsp              Hsp?                      @relation(fields: [secondaryHspId], references: [id], onDelete: Cascade)
    @@index([expiresAt])
    @@index([generatedAt])
    @@index([isBlocked])
    @@index([isExpired])
    @@index([isVerified])
    @@index([otpCode])
    @@index([patientId])
    @@index([requestedByUserId])
    @@index([secondaryAssignmentId])
    @@map("patientConsentOtps")
}

model PatientProviderAssignment {
    id                 String             @id @db.Uuid
    patientId          String             @db.Uuid
    providerId         String             @db.Uuid
    role               String?            @default("primary") @db.VarChar(50)
    assignedAt         DateTime?
    assignedBy         String?            @db.Uuid
    endedAt            DateTime?
    notes              String?
    assignedByUser     User?              @relation(fields: [assignedBy], references: [id], onDelete: NoAction, onUpdate: NoAction)
    patient            Patient            @relation(fields: [patientId], references: [id], onDelete: NoAction, onUpdate: NoAction)
    healthcareProvider HealthcareProvider @relation(fields: [providerId], references: [id], onDelete: NoAction, onUpdate: NoAction)
    @@unique([patientId, providerId, role, endedAt])
    @@map("patientProviderAssignments")
}

model PatientProviderConsentHistory {
    id                    String                        @id @db.Uuid
    patientId             String                        @db.Uuid
    previousProviderId    String?                       @db.Uuid
    newProviderId         String                        @db.Uuid
    doctorId              String?                       @db.Uuid
    hspId                 String?                       @db.Uuid
    consentRequired       Boolean?                      @default(false)
    consentRequested      Boolean?                      @default(false)
    consentRequestedAt    DateTime?
    consentGiven          Boolean?                      @default(false)
    consentGivenAt        DateTime?
    consentMethod         PatientProviderConsentMethod?
    consentToken          String?                       @db.VarChar(100)
    consentTokenExpiresAt DateTime?
    consentVerified       Boolean?                      @default(false)
    consentDenied         Boolean?                      @default(false)
    consentDeniedAt       DateTime?
    reason                String?
    initiatedBy           String?                       @db.Uuid
    status                PatientProviderConsentStatus? @default(PENDING)
    metadata              Json?                         @default("{}")
    createdAt             DateTime?
    updatedAt             DateTime?
    doctor                Doctor?                       @relation(fields: [doctorId], references: [id], onUpdate: NoAction)
    hsp                   Hsp?                          @relation(fields: [hspId], references: [id], onUpdate: NoAction)
    newProvider           Organization                  @relation("NewProviderConsents", fields: [newProviderId], references: [id], onDelete: Cascade, onUpdate: NoAction)
    patient               Patient                       @relation(fields: [patientId], references: [id], onDelete: Cascade, onUpdate: NoAction)
    previousProvider      Organization?                 @relation("PreviousProviderConsents", fields: [previousProviderId], references: [id], onUpdate: NoAction)
    @@index([consentRequestedAt])
    @@index([doctorId])
    @@index([hspId])
    @@index([newProviderId])
    @@index([patientId, status])
    @@map("patientProviderConsentHistory")
}

model PaymentMethod {
    id                    String            @id @db.Uuid
    patientId             String            @db.Uuid
    stripePaymentMethodId String            @unique @db.VarChar(255)
    type                  PaymentMethodType
    cardBrand             String?           @db.VarChar(50)
    cardLast4             String?           @db.VarChar(4)
    cardExpMonth          Int?
    cardExpYear           Int?
    bankName              String?           @db.VarChar(100)
    bankLast4             String?           @db.VarChar(4)
    isDefault             Boolean?          @default(false)
    isActive              Boolean?          @default(true)
    billingAddress        Json?             @db.Json
    metadata              Json?             @default("{}") @db.Json
    createdAt             DateTime
    updatedAt             DateTime
    deletedAt             DateTime?
    patient               Patient           @relation(fields: [patientId], references: [id], onDelete: NoAction, onUpdate: NoAction)
    payments              Payment[]
    @@index([isActive])
    @@index([isDefault])
    @@index([patientId])
    @@index([stripePaymentMethodId])
    @@index([type])
    @@map("paymentMethods")
}

model Payment {
    id                    String              @id @db.Uuid
    subscriptionId        String              @db.Uuid
    patientId             String              @db.Uuid
    providerId            String              @db.Uuid
    amount                Decimal             @db.Decimal(10, 2)
    currency              String?             @default("USD") @db.VarChar(3)
    status                PaymentStatus?      @default(PENDING)
    paymentMethod         PaymentMethod       @relation(fields: [paymentMethodId], references: [id])
    paymentMethodId       String              @db.Uuid
    stripePaymentIntentId String?             @unique @db.VarChar(255)
    stripeChargeId        String?             @db.VarChar(255)
    failureCode           String?             @db.VarChar(100)
    failureMessage        String?
    refundAmount          Decimal?            @default(0) @db.Decimal(10, 2)
    refundReason          String?             @db.VarChar(255)
    invoiceId             String?             @db.VarChar(255)
    billingPeriodStart    DateTime?           @db.Date
    billingPeriodEnd      DateTime?           @db.Date
    metadata              Json?               @default("{}") @db.Json
    createdAt             DateTime
    updatedAt             DateTime
    processedAt           DateTime?
    deletedAt             DateTime?
    patient               Patient             @relation(fields: [patientId], references: [id], onDelete: NoAction, onUpdate: NoAction)
    healthcareProvider    HealthcareProvider  @relation(fields: [providerId], references: [id], onDelete: NoAction, onUpdate: NoAction)
    patientSubscription   PatientSubscription @relation(fields: [subscriptionId], references: [id], onDelete: NoAction, onUpdate: NoAction)
    @@index([billingPeriodStart, billingPeriodEnd])
    @@index([createdAt])
    @@index([patientId])
    @@index([providerId])
    @@index([status])
    @@index([stripePaymentIntentId])
    @@index([subscriptionId])
    @@index([paymentMethodId])
    @@map("payments")
}

model ProviderChange {
    id                    String                         @id @db.Uuid
    practitionerType      ProviderChangePractitionerType
    practitionerId        String                         @db.Uuid
    previousProviderId    String?                        @db.Uuid
    newProviderId         String                         @db.Uuid
    changeDate            DateTime
    affectedPatientsCount Int?                           @default(0)
    consentRequiredCount  Int?                           @default(0)
    consentObtainedCount  Int?                           @default(0)
    reason                String?
    status                ProviderChangeStatus?          @default(ACTIVE)
    createdAt             DateTime?
    updatedAt             DateTime?
    newProvider           Organization                   @relation("NewProviderChanges", fields: [newProviderId], references: [id], onDelete: Cascade, onUpdate: NoAction)
    previousProvider      Organization?                  @relation("PreviousProviderChanges", fields: [previousProviderId], references: [id], onUpdate: NoAction)
    @@index([changeDate])
    @@index([newProviderId])
    @@index([practitionerType, practitionerId])
    @@index([status])
    @@map("providerChanges")
}

model Provider {
    id          String    @id @db.Uuid
    userId      String    @db.Uuid
    name        String    @db.VarChar(100)
    address     String?   @db.VarChar(255)
    city        String?   @db.VarChar(255)
    state       String?   @db.VarChar(255)
    activatedOn DateTime?
    details     Json?     @db.Json
    createdAt   DateTime
    updatedAt   DateTime
    deletedAt   DateTime?
    user        User      @relation(fields: [userId], references: [id], onDelete: NoAction, onUpdate: NoAction)
    @@index([userId])
    @@map("providers")
}

model ScheduleEvent {
    id        String               @id @db.Uuid
    critical  Boolean?
    eventType ScheduleEventType?
    eventId   String?              @db.Uuid
    details   Json?                @db.Json
    status    ScheduledEventStatus @default(PENDING)
    date      DateTime?            @db.Date
    startTime DateTime?
    endTime   DateTime?
    createdAt DateTime?
    updatedAt DateTime?
    deletedAt DateTime?
    @@index([eventId, eventType])
    @@index([eventType, status, date, startTime])
    @@index([status, date])
    @@map("scheduleEvents")
}

model ScheduledEvent {
    id               String                  @id @db.Uuid
    patientId        String                  @db.Uuid
    carePlanId       String?                 @db.Uuid
    eventType        ScheduledEventType
    eventId          String?                 @db.Uuid
    title            String                  @db.VarChar(255)
    description      String?
    scheduledFor     DateTime
    timezone         String?                 @default("UTC") @db.VarChar(50)
    status           ScheduledEventStatus?   @default(SCHEDULED)
    priority         ScheduledEventPriority? @default(MEDIUM)
    eventData        Json?                   @default("{}")
    completedAt      DateTime?
    completedBy      String?                 @db.Uuid
    createdAt        DateTime?
    updatedAt        DateTime?
    deletedAt        DateTime?
    adherenceRecords AdherenceRecord[]
    carePlan         CarePlan?               @relation(fields: [carePlanId], references: [id], onDelete: NoAction, onUpdate: NoAction)
    completedByUser  User?                   @relation(fields: [completedBy], references: [id], onDelete: NoAction, onUpdate: NoAction)
    patient          Patient                 @relation(fields: [patientId], references: [id], onDelete: NoAction, onUpdate: NoAction)
    @@index([carePlanId, scheduledFor, eventType], map: "idx_events_careplan_time_type")
    @@index([patientId, scheduledFor, status], map: "idx_events_patient_time_status")
    @@index([carePlanId])
    @@map("scheduledEvents")
}

model SecondaryDoctorAssignment {
    id                        String                                  @id @db.Uuid
    patientId                 String                                  @db.Uuid
    primaryDoctorId           String                                  @db.Uuid
    secondaryDoctorId         String?                                 @db.Uuid
    secondaryHspId            String?                                 @db.Uuid
    assignmentReason          String?
    specialtyFocus            String[]                                @default([])
    carePlanIds               String[]                                @default([])
    primaryDoctorProviderId   String?                                 @db.Uuid
    secondaryDoctorProviderId String?                                 @db.Uuid
    consentRequired           Boolean?                                @default(true)
    consentStatus             SecondaryDoctorAssignmentConsentStatus? @default(PENDING)
    accessGranted             Boolean?                                @default(false)
    firstAccessAttemptAt      DateTime?
    accessGrantedAt           DateTime?
    consentExpiresAt          DateTime?
    consentDurationMonths     Int?                                    @default(6)
    isActive                  Boolean?                                @default(true)
    assignmentStartDate       DateTime?
    assignmentEndDate         DateTime?
    createdAt                 DateTime?
    updatedAt                 DateTime?
    deletedAt                 DateTime?
    patientConsentOtps        PatientConsentOtp[]
    patient                   Patient                                 @relation(fields: [patientId], references: [id], onDelete: Cascade)
    primaryDoctor             Doctor                                  @relation("PrimaryDoctorSecondaryDoctorAssignments", fields: [primaryDoctorId], references: [id], onDelete: Cascade)
    primaryDoctorProvider     Organization?                           @relation("PrimaryDoctorProviderAssignments", fields: [primaryDoctorProviderId], references: [id])
    secondaryDoctor           Doctor?                                 @relation("SecondaryDoctorSecondaryDoctorAssignments", fields: [secondaryDoctorId], references: [id], onDelete: Cascade)
    secondaryDoctorProvider   Organization?                           @relation("SecondaryDoctorProviderAssignments", fields: [secondaryDoctorProviderId], references: [id])
    secondaryHsp              Hsp?                                    @relation(fields: [secondaryHspId], references: [id], onDelete: Cascade)
    @@index([accessGranted])
    @@index([consentExpiresAt])
    @@index([consentStatus])
    @@index([isActive])
    @@index([patientId])
    @@index([primaryDoctorId])
    @@index([secondaryDoctorId])
    @@index([secondaryHspId])
    @@map("secondaryDoctorAssignments")
}

model SymptomDatabase {
    id                 String    @id @db.Uuid
    diagnosisName      String    @unique @db.VarChar(255)
    symptoms           Json?     @default("{}")
    category           String?   @db.VarChar(100)
    severityIndicators Json?     @default("{}")
    commonAgeGroups    Json?     @default("[]")
    genderSpecific     String?   @db.VarChar(20)
    isActive           Boolean?  @default(true)
    createdBy          String?   @db.Uuid
    createdAt          DateTime?
    updatedAt          DateTime?
    deletedAt          DateTime?
    @@index([category])
    @@index([isActive])
    @@index([symptoms], type: Gin)
    @@map("symptomsDatabase")
}

model TreatmentDatabase {
    id                   String    @id @db.Uuid
    treatmentName        String    @unique @db.VarChar(255)
    treatmentType        String    @db.VarChar(50)
    description          String?
    applicableConditions Json?     @default("[]")
    duration             String?   @db.VarChar(100)
    frequency            String?   @db.VarChar(100)
    dosageInfo           Json?     @default("{}")
    category             String?   @db.VarChar(100)
    severityLevel        String?   @db.VarChar(20)
    ageRestrictions      Json?     @default("{}")
    contraindications    Json?     @default("[]")
    sideEffects          Json?     @default("[]")
    monitoringRequired   Json?     @default("[]")
    isActive             Boolean?  @default(true)
    requiresSpecialist   Boolean?  @default(false)
    prescriptionRequired Boolean?  @default(false)
    createdBy            String?   @db.Uuid
    createdAt            DateTime?
    updatedAt            DateTime?
    deletedAt            DateTime?
    @@index([applicableConditions], type: Gin)
    @@index([category])
    @@index([isActive])
    @@index([severityLevel])
    @@index([treatmentType])
    @@map("treatmentDatabase")
}

model TreatmentPlan {
    id                   String         @id @db.Uuid
    patientId            String         @db.Uuid
    doctorId             String         @db.Uuid
    organizationId       String?        @db.Uuid
    title                String         @db.VarChar(255)
    description          String?
    planType             String?        @default("treatment_plan") @db.VarChar(20)
    primaryDiagnosis     String         @db.VarChar(255)
    secondaryDiagnoses   String[]       @default([])
    chiefComplaint       String?
    symptoms             Json?          @default("[]")
    treatmentGoals       Json?          @default("[]")
    interventions        Json?          @default("[]")
    medications          Json?          @default("[]")
    instructions         String?
    startDate            DateTime
    expectedDurationDays Int?
    endDate              DateTime?
    followUpRequired     Boolean?       @default(true)
    followUpDate         DateTime?
    followUpInstructions String?
    status               String?        @default("ACTIVE") @db.VarChar(20)
    priority             String?        @default("MEDIUM") @db.VarChar(20)
    progressNotes        Json?          @default("[]")
    completionPercentage Int?           @default(0)
    outcome              String?
    emergencyContacts    Json?          @default("[]")
    warningSigns         String[]       @default([])
    assignedHsps         String[]       @default([])
    careTeamNotes        Json?          @default("[]")
    createdAt            DateTime?
    updatedAt            DateTime?
    deletedAt            DateTime?
    notifications        Notification[]
    doctor               Doctor         @relation(fields: [doctorId], references: [id], onDelete: NoAction)
    organization         Organization?  @relation(fields: [organizationId], references: [id], onDelete: NoAction, onUpdate: NoAction)
    patient              Patient        @relation(fields: [patientId], references: [id], onDelete: Cascade)
    adherenceLogs        AdherenceLog[]
    @@index([doctorId])
    @@index([endDate])
    @@index([followUpDate])
    @@index([organizationId])
    @@index([patientId])
    @@index([primaryDiagnosis])
    @@index([priority])
    @@index([secondaryDiagnoses], type: Gin)
    @@index([startDate])
    @@index([status])
    @@index([symptoms], type: Gin)
    @@map("treatmentPlans")
}

model UserRoleAssignment {
    id           String              @id @db.Uuid
    userIdentity String              @db.Uuid
    linkedWith   UserRoleLinkedWith?
    linkedId     String?             @db.Uuid
    createdAt    DateTime
    updatedAt    DateTime
    deletedAt    DateTime?
    user         User                @relation(fields: [userIdentity], references: [id], onDelete: NoAction, onUpdate: NoAction)
    @@index([userIdentity, linkedWith], map: "idx_userroles_identity_linked")
    @@map("userRoleAssignments")
}

model VitalRequirement {
    id              String    @id @db.Uuid
    carePlanId      String    @db.Uuid
    vitalTypeId     String    @db.Uuid
    frequency       String    @db.VarChar(100)
    preferredTime   DateTime? @db.Time(6)
    isCritical      Boolean?  @default(false)
    monitoringNotes String?
    createdAt       DateTime?
    updatedAt       DateTime?
    deletedAt       DateTime?
    carePlan        CarePlan  @relation(fields: [carePlanId], references: [id], onDelete: NoAction, onUpdate: NoAction)
    vitalType       VitalType @relation(fields: [vitalTypeId], references: [id], onDelete: NoAction)
    @@index([carePlanId])
    @@index([frequency])
    @@index([isCritical])
    @@index([vitalTypeId])
    @@map("vitalRequirements")
}

model VitalTemplate {
    id        String    @id @db.Uuid
    name      String    @db.VarChar(255)
    unit      String?   @db.VarChar(255)
    details   Json?     @db.Json
    createdAt DateTime
    updatedAt DateTime
    deletedAt DateTime?
    vitals    Vital[]
    @@map("vitalTemplates")
}

model Vital {
    id              String        @id @db.Uuid
    vitalTemplateId String        @db.Uuid
    carePlanId      String        @db.Uuid
    details         Json?         @db.Json
    description     String?       @db.VarChar(1000)
    startDate       DateTime?
    endDate         DateTime?
    createdAt       DateTime
    updatedAt       DateTime
    deletedAt       DateTime?
    carePlan        CarePlan      @relation(fields: [carePlanId], references: [id], onDelete: NoAction)
    vitalTemplate   VitalTemplate @relation(fields: [vitalTemplateId], references: [id], onDelete: NoAction)
    @@index([carePlanId])
    @@index([vitalTemplateId])
    @@map("vitals")
}

enum AdherenceType {
    MEDICATION
    APPOINTMENT
    VITAL_CHECK
    SYMPTOM_LOG
    DIET_LOG
    EXERCISE
    REMINDER
}

enum AppointmentSlotType {
    REGULAR
    EMERGENCY
    CONSULTATION
    FOLLOW_UP
}

enum AppointmentOrganizerType {
    DOCTOR
    PATIENT
    CARE_TAKER
    HSP
    PROVIDER
    ADMIN
}

enum AppointmentParticipantOneType {
    DOCTOR
    PATIENT
    HSP
}

enum AppointmentParticipantTwoType {
    DOCTOR
    PATIENT
    HSP
}

enum DashboardMetricsEntityType {
    PATIENT
    DOCTOR
    ORGANIZATION
    SYSTEM
}

enum MedicationLogAdherenceStatus {
    TAKEN
    MISSED
    LATE
    PARTIAL
}

enum MedicationOrganizerType {
    DOCTOR
    PATIENT
    CARE_TAKER
    HSP
    PROVIDER
    ADMIN
}

enum PatientAlertType {
    MEDICATION
    VITAL
    APPOINTMENT
    SYMPTOM
    SYSTEM
}

enum PatientAlertSeverity {
    CRITICAL
    HIGH
    MEDIUM
    LOW
}

enum PatientConsentOtpMethod {
    SMS
    EMAIL
    BOTH
}

enum PatientProviderConsentMethod {
    SMS
    EMAIL
    IN_PERSON
    PHONE
    AUTOMATIC
}

enum PatientProviderConsentStatus {
    PENDING
    CONSENT_REQUESTED
    APPROVED
    DENIED
    EXPIRED
    COMPLETED
}

enum PatientSubscriptionStatus {
    ACTIVE
    INACTIVE
    PAST_DUE
    CANCELLED
    EXPIRED
    TRIALING
}

enum PatientProviderConsentMethodLegacy {
    SMS
    EMAIL
    IN_PERSON
    PHONE
    AUTOMATIC
}

enum PaymentMethodType {
    CARD
    BANK_ACCOUNT
    PAYPAL
    APPLE_PAY
    GOOGLE_PAY
}

enum ProviderChangePractitionerType {
    DOCTOR
    HSP
}

enum ProviderChangeStatus {
    ACTIVE
    PROCESSING
    COMPLETED
}

enum ScheduleEventType {
    APPOINTMENT
    REMINDER
    MEDICATION_REMINDER @map("medicationReminder")
    VITALS
    CAREPLAN_ACTIVATION @map("careplanActivation")
    DIET
    WORKOUT
}

enum ScheduledEventType {
    MEDICATION
    APPOINTMENT
    VITAL_CHECK
    SYMPTOM_LOG
    DIET_LOG
    EXERCISE
    REMINDER
}

enum ScheduledEventPriority {
    LOW
    MEDIUM
    HIGH
    CRITICAL
}

enum ScheduledEventStatus {
    SCHEDULED
    PENDING
    IN_PROGRESS
    COMPLETED
    MISSED
    CANCELLED
    EXPIRED
    STARTED
    PRIOR
}

enum PatientDoctorAssignmentType {
    PRIMARY
    SPECIALIST
    SUBSTITUTE
    TRANSFERRED
}

enum PatientDoctorAssignmentConsentStatus {
    NOT_REQUIRED
    PENDING
    REQUESTED
    GRANTED
    DENIED
    EXPIRED
}

enum SecondaryDoctorAssignmentConsentStatus {
    PENDING
    REQUESTED
    GRANTED
    DENIED
    EXPIRED
}

enum ServicePlanBillingCycle {
    MONTHLY
    YEARLY
    ONE_TIME @map("oneTime")
    WEEKLY
}

enum UserRoleLinkedWith {
    DOCTOR
    PATIENT
    CARE_TAKER
    HSP
    PROVIDER
    ADMIN
}

enum UserAccountStatus {
    PENDING_VERIFICATION
    ACTIVE
    INACTIVE
    SUSPENDED
    DEACTIVATED
}

enum UserGender {
    MALE
    FEMALE
    OTHER
    PREFER_NOT_TO_SAY
}

enum VitalReadingAlertLevel {
    NORMAL
    WARNING
    CRITICAL
    EMERGENCY
}

model PatientAllergy {
    id               String          @id @default(uuid()) @db.Uuid
    patientId        String          @db.Uuid
    allergenType     AllergenType
    allergenName     String          @db.VarChar(255)
    allergenRxnorm   String?         @db.VarChar(50) // RxNorm code if medication
    reactionSeverity AllergySeverity
    reactionSymptoms String?         @db.Text
    onsetDate        DateTime?       @db.Date
    verifiedByDoctor Boolean         @default(false)
    verifiedBy       String?         @db.Uuid
    notes            String?         @db.Text
    isActive         Boolean         @default(true)
    createdAt        DateTime        @default(now()) @db.Timestamptz(6)
    updatedAt        DateTime        @updatedAt @db.Timestamptz(6)
    patient                Patient                 @relation(fields: [patientId], references: [id], onDelete: Cascade)
    verifiedByUser         User?                   @relation(fields: [verifiedBy], references: [id])
    medicationSafetyAlerts MedicationSafetyAlert[]
    @@index([patientId, isActive])
    @@index([allergenType, allergenName])
    @@map("patientAllergies")
}

model MedicationSafetyAlert {
    id                String              @id @default(uuid()) @db.Uuid
    patientId         String              @db.Uuid
    medicationId      String?             @db.Uuid
    drugInteractionId String?             @db.Uuid
    patientAllergyId  String?             @db.Uuid
    alertType         MedicationAlertType
    severity          AlertSeverity
    alertTitle        String              @db.VarChar(255)
    alertMessage      String              @db.Text
    recommendation    String?             @db.Text
    requiresOverride  Boolean             @default(false)
    resolved          Boolean             @default(false)
    resolvedBy        String?             @db.Uuid
    resolvedAt        DateTime?
    resolutionNotes   String?             @db.Text
    overrideReason    String?             @db.Text
    createdBy         String?             @db.Uuid
    createdAt         DateTime            @default(now())
    updatedAt         DateTime            @updatedAt
    patient         Patient          @relation(fields: [patientId], references: [id], onDelete: Cascade)
    medication      Medication?      @relation(fields: [medicationId], references: [id])
    drugInteraction DrugInteraction? @relation(fields: [drugInteractionId], references: [id])
    patientAllergy  PatientAllergy?  @relation(fields: [patientAllergyId], references: [id])
    resolvedByUser  User?            @relation(fields: [resolvedBy], references: [id])
    createdByUser   User?            @relation("SafetyAlertCreatedBy", fields: [createdBy], references: [id])
    @@index([patientId, severity, resolved])
    @@index([alertType, createdAt])
    @@index([resolved, createdAt])
    @@map("medicationSafetyAlerts")
}

model EmergencyAlert {
    id                String             @id @default(uuid()) @db.Uuid
    patientId         String             @db.Uuid
    alertType         EmergencyAlertType
    priorityLevel     EmergencyPriority
    vitalReadingId    String?            @db.Uuid
    triggeredByRule   String?            @db.VarChar(255)
    alertTitle        String             @db.VarChar(255)
    alertMessage      String             @db.Text
    clinicalContext   String?            @db.Text
    acknowledged      Boolean            @default(false)
    acknowledgedBy    String?            @db.Uuid
    acknowledgedAt    DateTime?
    resolved          Boolean            @default(false)
    resolvedBy        String?            @db.Uuid
    resolvedAt        DateTime?
    resolutionNotes   String?            @db.Text
    notificationsSent Json               @default("[]")
    escalationLevel   Int                @default(0)
    maxEscalations    Int                @default(3)
    createdAt         DateTime           @default(now())
    updatedAt         DateTime           @updatedAt
    patient            Patient         @relation(fields: [patientId], references: [id], onDelete: Cascade)
    vitalReading       VitalReading?   @relation(fields: [vitalReadingId], references: [id])
    acknowledgedByUser User?           @relation("EmergencyAlertAcknowledged", fields: [acknowledgedBy], references: [id])
    resolvedByUser     User?           @relation("EmergencyAlertResolved", fields: [resolvedBy], references: [id])
    deviceReadings     DeviceReading[] @relation("DeviceReadingToEmergencyAlert")
    @@index([patientId, priorityLevel, acknowledged, resolved])
    @@index([alertType, createdAt])
    @@index([resolved, createdAt])
    @@map("emergencyAlerts")
}

model VitalAlertRule {
    id                String             @id @default(uuid()) @db.Uuid
    name              String             @db.VarChar(255)
    description       String?            @db.Text
    vitalType         String             @db.VarChar(100)
    conditionType     VitalConditionType
    thresholdValue    Decimal?           @db.Decimal(10, 2)
    thresholdMin      Decimal?           @db.Decimal(10, 2)
    thresholdMax      Decimal?           @db.Decimal(10, 2)
    unit              String?            @db.VarChar(20)
    alertLevel        AlertSeverity
    alertMessage      String             @db.Text
    notificationDelay Int                @default(0)
    minAge            Int?
    maxAge            Int?
    genderSpecific    String?            @db.VarChar(10)
    isActive          Boolean            @default(true)
    appliesToAll      Boolean            @default(true)
    patientConditions Json?              @default("[]")
    createdBy         String?            @db.Uuid
    createdAt         DateTime           @default(now())
    updatedAt         DateTime           @updatedAt
    createdByUser User? @relation(fields: [createdBy], references: [id])
    @@index([vitalType, isActive])
    @@index([alertLevel])
    @@map("vitalAlertRules")
}

model EmergencyContact {
    id                  String   @id @default(uuid())
    patientId           String
    name                String
    relationship        String
    phone               String
    email               String?
    address              Json?
    priorityOrder        Int       @default(1)
    canReceiveMedical    Boolean   @default(false)
    preferredContact     String    @default("phone") @db.VarChar(20)
    isActive             Boolean   @default(true)
    hipaaAuthorized      Boolean   @default(false)
    authorizationDate    DateTime?
    authorizationExpires DateTime?
    createdAt           DateTime @default(now())
    updatedAt           DateTime @updatedAt
    patient             Patient  @relation(fields: [patientId], references: [id], onDelete: Cascade)
    isPrimary           Boolean  @default(false)
    notifyOnEmergency   Boolean  @default(true)
    notifyOnMissedMeds  Boolean  @default(false)
    @@index([patientId, isActive])
    @@map("emergency_contacts")
}

model SideEffectReport {
    id              String             @id @default(uuid())
    medicationLogId String
    patientId       String
    symptom         String
    severity        SideEffectSeverity
    description     String?
    reportedAt      DateTime           @default(now())
    reviewedAt      DateTime?
    reviewedBy      String?
    medicationLog   MedicationLog      @relation(fields: [medicationLogId], references: [id], onDelete: Cascade)
    patient         Patient            @relation(fields: [patientId], references: [id], onDelete: Cascade)
    @@index([medicationLogId])
    @@map("side_effect_reports")
}

model MealPlan {
    id              String    @id @default(uuid())
    dietPlanId      String
    mealType        MealType
    scheduledTime   String    // e.g., "08:00"
    name            String
    description     String?
    targetCalories  Int?
    foods           Json?     // Recommended foods
    dietPlan        DietPlan  @relation(fields: [dietPlanId], references: [id], onDelete: Cascade)
    @@index([dietPlanId])
    @@map("meal_plans")
}

model FoodLogItem {
    id              String   @id @default(uuid())
    mealLogId       String
    foodName        String
    quantity        Float
    unit            String   // e.g., "serving", "grams", "cups"
    calories        Int?
    protein         Float?
    carbs           Float?
    fat             Float?
    fiber           Float?
    mealLog         MealLog  @relation(fields: [mealLogId], references: [id], onDelete: Cascade)
    @@index([mealLogId])
    @@map("food_log_items")
}

model WaterIntakeLog {
    id              String   @id @default(uuid())
    patientId       String
    amount          Int      // ml
    loggedAt        DateTime @default(now())
    patient         Patient  @relation(fields: [patientId], references: [id], onDelete: Cascade)
    @@index([patientId, loggedAt])
    @@map("water_intake_logs")
}

model ExercisePlan {
    id                  String             @id @default(uuid())
    patientId           String
    carePlanId          String?
    name                String
    description         String?
    weeklyGoalMinutes   Int?
    weeklyGoalSessions  Int?
    restrictions        String[]           // e.g., ["no high impact"]
    startDate           DateTime
    endDate             DateTime?
    isActive            Boolean            @default(true)
    createdBy           String
    createdAt           DateTime           @default(now())
    updatedAt           DateTime           @updatedAt
    patient             Patient            @relation(fields: [patientId], references: [id], onDelete: Cascade)
    carePlan            CarePlan?          @relation(fields: [carePlanId], references: [id])
    scheduledWorkouts   ScheduledWorkout[]
    exerciseLogs        ExerciseLog[]
    @@index([patientId])
    @@map("exercise_plans")
}

model ScheduledWorkout {
    id              String       @id @default(uuid())
    exercisePlanId  String
    dayOfWeek       Int          // 0-6 (Sunday-Saturday)
    name            String
    description     String?
    targetDuration  Int          // minutes
    exercises       Json         // Array of exercise objects
    exercisePlan    ExercisePlan @relation(fields: [exercisePlanId], references: [id], onDelete: Cascade)
    @@index([exercisePlanId])
    @@map("scheduled_workouts")
}

model DailyActivitySummary {
    id                  String   @id @default(uuid())
    patientId           String
    date                DateTime @db.Date
    totalSteps          Int      @default(0)
    totalDistance       Float    @default(0) // km
    totalCaloriesBurned Int      @default(0)
    activeMinutes       Int      @default(0)
    sedentaryMinutes    Int?
    flightsClimbed      Int?
    restingHeartRate    Int?
    patient             Patient  @relation(fields: [patientId], references: [id], onDelete: Cascade)
    @@unique([patientId, date])
    @@map("daily_activity_summaries")
}

model GoalMilestone {
    id              String     @id @default(uuid())
    goalId          String
    title           String
    targetValue     Float?
    achievedAt      DateTime?
    sortOrder       Int        @default(0)
    goal            HealthGoal @relation(fields: [goalId], references: [id], onDelete: Cascade)
    @@index([goalId])
    @@map("goal_milestones")
}

model GoalProgressLog {
    id              String     @id @default(uuid())
    goalId          String
    value           Float
    notes           String?
    loggedAt        DateTime   @default(now())
    goal            HealthGoal @relation(fields: [goalId], references: [id], onDelete: Cascade)
    @@index([goalId])
    @@map("goal_progress_logs")
}

model PatientReminder {
    id              String         @id @default(uuid())
    patientId       String
    type            ReminderType
    title           String
    message         String?
    scheduledFor    DateTime
    sentAt          DateTime?
    acknowledgedAt  DateTime?
    status          ReminderStatus @default(SCHEDULED)
    relatedId       String?        // ID of related entity
    relatedType     String?        // "medication", "appointment", etc.
    patient         Patient        @relation(fields: [patientId], references: [id], onDelete: Cascade)
    @@index([status, scheduledFor])
    @@map("patient_reminders")
}

model EducationalContent {
    id                  String              @id @default(uuid())
    title               String
    slug                String              @unique
    contentType         ContentType
    category            String
    tags                String[]
    summary             String?
    content             String              // Rich text / markdown
    mediaUrl            String?
    thumbnailUrl        String?
    duration            Int?                // For videos, in seconds
    difficulty          ContentDifficulty   @default(BEGINNER)
    relatedConditions   String[]
    isPublished         Boolean             @default(false)
    viewCount           Int                 @default(0)
    createdAt           DateTime            @default(now())
    updatedAt           DateTime            @updatedAt
    patientViews        PatientContentView[]
    @@map("educational_content")
}

model PatientContentView {
    id              String             @id @default(uuid())
    patientId       String
    contentId       String
    viewedAt        DateTime           @default(now())
    completedAt     DateTime?
    rating          Int?               // 1-5
    feedback        String?
    patient         Patient            @relation(fields: [patientId], references: [id], onDelete: Cascade)
    content         EducationalContent @relation(fields: [contentId], references: [id], onDelete: Cascade)
    @@unique([patientId, contentId])
    @@map("patient_content_views")
}

model MessageConversation {
    id              String             @id @default(uuid())
    patientId       String
    providerId      String             // Doctor or HSP
    providerType    String             // "doctor" or "hsp"
    subject         String?
    status          ConversationStatus @default(OPEN)
    lastMessageAt   DateTime           @default(now())
    createdAt       DateTime           @default(now())
    patient         Patient            @relation(fields: [patientId], references: [id], onDelete: Cascade)
    messages        PatientMessage[]
    @@index([patientId, lastMessageAt])
    @@map("message_conversations")
}

model PatientMessage {
    id              String              @id @default(uuid())
    conversationId  String
    senderId        String
    senderType      MessageSenderType
    content         String
    attachments     Json?               // Array of attachment objects
    isRead          Boolean             @default(false)
    readAt          DateTime?
    createdAt       DateTime            @default(now())
    conversation    MessageConversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)
    @@index([conversationId, createdAt])
    @@map("patient_messages")
}

model PatientSettings {
    id                      String   @id @default(uuid())
    patientId               String   @unique
    theme                   String   @default("light")
    language                String   @default("en")
    dateFormat              String   @default("MM/DD/YYYY")
    timeFormat              String   @default("12h")
    measurementSystem       String   @default("imperial")
    shareDataWithCareTeam   Boolean  @default(true)
    allowAnonymousAnalytics Boolean  @default(true)
    showOnLeaderboard       Boolean  @default(false)
    fontSize                String   @default("medium")
    highContrast            Boolean  @default(false)
    reduceMotion            Boolean  @default(false)
    patient                 Patient  @relation(fields: [patientId], references: [id], onDelete: Cascade)
    @@map("patient_settings")
}

enum AllergenType {
    MEDICATION
    FOOD
    ENVIRONMENTAL
    LATEX
    OTHER
}

enum AllergySeverity {
    MILD
    MODERATE
    SEVERE
    ANAPHYLAXIS
}

enum MedicationAlertType {
    DRUG_INTERACTION
    ALLERGY_CONFLICT
    DOSE_LIMIT_EXCEEDED
    DUPLICATE_THERAPY
    AGE_INAPPROPRIATE
    CONTRAINDICATION
    MONITORING_REQUIRED
}

enum AlertSeverity {
    LOW
    MEDIUM
    HIGH
    CRITICAL
}

enum EmergencyAlertType {
    VITAL_CRITICAL
    MEDICATION_MISSED_CRITICAL
    DEVICE_OFFLINE
    PATIENT_UNRESPONSIVE
    EMERGENCY_BUTTON
    FALL_DETECTED
    MEDICATION_OVERDOSE
}

enum EmergencyPriority {
    LOW
    MEDIUM
    HIGH
    EMERGENCY
    LIFE_THREATENING
}

enum VitalConditionType {
    GREATER_THAN
    LESS_THAN
    BETWEEN
    OUTSIDE_RANGE
    PERCENTAGE_CHANGE
}

enum ConsultationType {
    VIDEO_CONSULTATION
    AUDIO_CONSULTATION
    CHAT_CONSULTATION
    EMERGENCY_CONSULTATION
    FOLLOW_UP_CONSULTATION
    SPECIALIST_REFERRAL
}

enum ConsultationStatus {
    SCHEDULED
    IN_PROGRESS
    COMPLETED
    CANCELLED
    NO_SHOW
    RESCHEDULED
    INTERRUPTED
}

enum ConsultationPriority {
    ROUTINE
    URGENT
    EMERGENCY
    FOLLOW_UP
}

enum LabOrderStatus {
    ORDERED
    SAMPLE_COLLECTED
    IN_PROGRESS
    COMPLETED
    CANCELLED
    REPORT_READY
}

enum LabTestCategory {
    BLOOD_CHEMISTRY
    HEMATOLOGY
    MICROBIOLOGY
    PATHOLOGY
    RADIOLOGY
    CARDIOLOGY
    ENDOCRINOLOGY
    IMMUNOLOGY
}

enum GameBadgeType {
    ADHERENCE_STREAK
    APPOINTMENT_KEEPER
    VITAL_TRACKER
    EXERCISE_CHAMPION
    MEDICATION_MASTER
    HEALTH_IMPROVEMENT
    GOAL_ACHIEVER
}

enum GameChallengeType {
    DAILY_MEDICATION
    WEEKLY_VITALS
    MONTHLY_CHECKUP
    EXERCISE_MINUTES
    WEIGHT_MANAGEMENT
    BLOOD_PRESSURE_CONTROL
    GLUCOSE_MANAGEMENT
}

enum DeviceType {
    WEARABLE
    BLOOD_PRESSURE
    GLUCOSE_METER
    PULSE_OXIMETER
    THERMOMETER
    ECG_MONITOR
    SCALE
    SPIROMETER
    GENERIC_BLUETOOTH
}

enum DeviceStatus {
    CONNECTED
    DISCONNECTED
    SYNCING
    ERROR
    MAINTENANCE
}

enum ConnectionType {
    BLUETOOTH_LE
    WIFI
    API_OAUTH
    MANUAL_ENTRY
    BRIDGE_DEVICE
}

model VideoConsultation {
    id                       String                     @id @default(uuid()) @db.Uuid
    consultationId           String                     @unique @db.VarChar(255)
    doctorId                 String                     @db.Uuid
    patientId                String                     @db.Uuid
    appointmentId            String?                    @db.Uuid
    consultationType         ConsultationType           @default(VIDEO_CONSULTATION)
    status                   ConsultationStatus         @default(SCHEDULED)
    priority                 ConsultationPriority       @default(ROUTINE)
    scheduledStart           DateTime
    scheduledEnd             DateTime
    actualStart              DateTime?
    actualEnd                DateTime?
    timezone                 String                     @default("UTC") @db.VarChar(50)
    roomId                   String?                    @unique @db.VarChar(255)
    roomToken                String?                    @db.Text
    doctorJoinUrl            String?                    @db.Text
    patientJoinUrl           String?                    @db.Text
    recordingEnabled         Boolean                    @default(false)
    recordingUrl             String?                    @db.Text
    chiefComplaint           String?                    @db.Text
    presentingSymptoms       String[]                   @default([])
    consultationNotes        String?                    @db.Text
    diagnosis                String?                    @db.Text
    treatmentPlan            String?                    @db.Text
    followUpRequired         Boolean                    @default(false)
    followUpDate             DateTime?
    connectionQuality        Json?                      @default("{}")
    technicalIssues          String[]                   @default([])
    durationMinutes          Int?
    consultationFee          Decimal?                   @db.Decimal(10, 2)
    insuranceCovered         Boolean                    @default(false)
    paymentStatus            String?                    @default("pending") @db.VarChar(50)
    createdBy                String                     @db.Uuid
    createdAt                DateTime                   @default(now())
    updatedAt                DateTime                   @updatedAt
    doctor                   Doctor                     @relation(fields: [doctorId], references: [id], onDelete: Cascade)
    patient                  Patient                    @relation(fields: [patientId], references: [id], onDelete: Cascade)
    appointment              Appointment?               @relation(fields: [appointmentId], references: [id])
    creator                  User                       @relation("ConsultationCreatedBy", fields: [createdBy], references: [id])
    prescriptions            ConsultationPrescription[]
    labOrders                LabOrder[]
    consultationNotesEntries ConsultationNote[]
    @@index([doctorId, scheduledStart])
    @@index([patientId, status])
    @@index([status, scheduledStart])
    @@index([consultationType, priority])
    @@map("videoConsultations")
}

model ConsultationPrescription {
    id                   String            @id @default(uuid()) @db.Uuid
    consultationId       String            @db.Uuid
    medicationName       String            @db.VarChar(255)
    dosage               String            @db.VarChar(100)
    frequency            String            @db.VarChar(100)
    durationDays         Int
    quantity             Int?
    instructions         String?           @db.Text
    refillsAllowed       Int               @default(0)
    ndcCode              String?           @db.VarChar(50)
    genericSubstitution  Boolean           @default(true)
    pharmacyInstructions String?           @db.Text
    createdAt            DateTime          @default(now())
    consultation         VideoConsultation @relation(fields: [consultationId], references: [id], onDelete: Cascade)
    @@index([consultationId])
    @@map("consultationPrescriptions")
}

model LabResult {
    id             String    @id @default(uuid()) @db.Uuid
    labOrderId     String    @db.Uuid
    testName       String    @db.VarChar(255)
    testCode       String?   @db.VarChar(50)
    resultValue    String?   @db.VarChar(255)
    numericValue   Decimal?  @db.Decimal(10, 3)
    resultUnit     String?   @db.VarChar(50)
    referenceRange String?   @db.VarChar(255)
    resultStatus   String    @default("final") @db.VarChar(50)
    abnormalFlag   String?   @db.VarChar(10)
    criticalFlag   Boolean   @default(false)
    collectionDate DateTime?
    resultDate     DateTime  @default(now())
    verifiedDate   DateTime?
    method         String?   @db.VarChar(255)
    specimenType   String?   @db.VarChar(100)
    comments       String?   @db.Text
    createdAt      DateTime  @default(now())
    labOrder       LabOrder  @relation(fields: [labOrderId], references: [id], onDelete: Cascade)
    @@index([labOrderId])
    @@index([testName, resultDate])
    @@index([criticalFlag, resultDate])
    @@map("labResults")
}

model PatientGameProfile {
    id                   String                  @id @default(uuid()) @db.Uuid
    patientId            String                  @unique @db.Uuid
    totalPoints          Int                     @default(0)
    currentLevel         Int                     @default(1)
    experiencePoints     Int                     @default(0)
    medicationStreak     Int                     @default(0)
    appointmentStreak    Int                     @default(0)
    vitalsStreak         Int                     @default(0)
    longestStreak        Int                     @default(0)
    badgesEarned         String[]                @default([])
    challengesCompleted  String[]                @default([])
    loginStreak          Int                     @default(0)
    lastActivity         DateTime?
    totalActivities      Int                     @default(0)
    gamificationEnabled  Boolean                 @default(true)
    notificationsEnabled Boolean                 @default(true)
    publicProfile        Boolean                 @default(false)
    createdAt            DateTime                @default(now())
    updatedAt            DateTime                @updatedAt
    patient              Patient                 @relation(fields: [patientId], references: [id], onDelete: Cascade)
    badgeAwards          GameBadgeAward[]
    challengeProgress    GameChallengeProgress[]
    @@index([totalPoints, currentLevel])
    @@index([patientId, lastActivity])
    @@map("patientGameProfiles")
}

model GameBadgeAward {
    id               String             @id @default(uuid()) @db.Uuid
    patientId        String             @db.Uuid
    badgeType        GameBadgeType
    badgeName        String             @db.VarChar(255)
    badgeDescription String?            @db.Text
    pointsAwarded    Int                @default(0)
    awardedDate      DateTime           @default(now())
    badgeIcon        String?            @db.VarChar(255)
    badgeColor       String?            @db.VarChar(50)
    achievementData  Json?              @default("{}")
    gameProfile      PatientGameProfile @relation(fields: [patientId], references: [patientId], onDelete: Cascade)
    @@index([patientId, awardedDate])
    @@index([badgeType])
    @@map("gameBadgeAwards")
}

model GameChallengeProgress {
    id              String             @id @default(uuid()) @db.Uuid
    patientId       String             @db.Uuid
    challengeType   GameChallengeType
    challengeName   String             @db.VarChar(255)
    targetValue     Int
    currentProgress Int                @default(0)
    startDate       DateTime
    endDate         DateTime
    isCompleted     Boolean            @default(false)
    completionDate  DateTime?
    pointsEarned    Int                @default(0)
    challengeRules  Json?              @default("{}")
    progressData    Json?              @default("{}")
    createdAt       DateTime           @default(now())
    updatedAt       DateTime           @updatedAt
    gameProfile     PatientGameProfile @relation(fields: [patientId], references: [patientId], onDelete: Cascade)
    @@index([patientId, isCompleted])
    @@index([challengeType, endDate])
    @@map("gameChallengeProgress")
}

model ConnectedDevice {
    id                  String          @id @default(uuid()) @db.Uuid
    patientId           String          @db.Uuid
    pluginId            String          @db.VarChar(100)
    deviceName          String          @db.VarChar(255)
    deviceModel         String?         @db.VarChar(255)
    deviceType          DeviceType
    manufacturer        String?         @db.VarChar(255)
    serialNumber        String?         @db.VarChar(100)
    firmwareVersion     String?         @db.VarChar(50)
    connectionType      ConnectionType
    deviceIdentifier    String          @db.VarChar(255)
    connectionConfig    Json?           @default("{}")
    lastConnected       DateTime?
    connectionStatus    DeviceStatus    @default(DISCONNECTED)
    autoSyncEnabled     Boolean         @default(true)
    syncIntervalMinutes Int             @default(15)
    lastSync            DateTime?
    syncErrorCount      Int             @default(0)
    isActive            Boolean         @default(true)
    addedBy             String          @db.Uuid
    notes               String?         @db.Text
    createdAt           DateTime        @default(now())
    updatedAt           DateTime        @updatedAt
    patient             Patient         @relation(fields: [patientId], references: [id], onDelete: Cascade)
    addedByUser         User            @relation(fields: [addedBy], references: [id], onDelete: Restrict)
    deviceReadings      DeviceReading[]
    @@unique([patientId, deviceIdentifier])
    @@index([pluginId, deviceType])
    @@index([patientId, connectionStatus])
    @@map("connectedDevices")
}

model DeviceReading {
    id                   String           @id @default(uuid()) @db.Uuid
    deviceId             String           @db.Uuid
    patientId            String           @db.Uuid
    pluginId             String           @db.VarChar(100)
    medicalDeviceId      String?          @db.Uuid
    vitalReadingId       String?          @db.Uuid
    readingType          String           @db.VarChar(100)
    measurementTimestamp DateTime
    receivedTimestamp    DateTime         @default(now())
    rawData              Json             @default("{}")
    processedValues      Json             @default("{}")
    primaryValue         Decimal?         @db.Decimal(10, 3)
    secondaryValue       Decimal?         @db.Decimal(10, 3)
    measurementUnit      String?          @db.VarChar(50)
    dataQualityScore     Decimal?         @db.Decimal(3, 2)
    isValidated          Boolean          @default(false)
    validationNotes      String?          @db.Text
    isAnomaly            Boolean          @default(false)
    anomalyReason        String?          @db.VarChar(255)
    readingContext       String?          @db.VarChar(255)
    symptomsReported     String[]         @default([])
    medicationTaken      Boolean?
    triggeredAlerts      Boolean          @default(false)
    alertReasons         String[]         @default([])
    syncBatchId          String?          @db.Uuid
    createdAt            DateTime         @default(now())
    device               ConnectedDevice  @relation(fields: [deviceId], references: [id], onDelete: Cascade)
    patient              Patient          @relation(fields: [patientId], references: [id], onDelete: Cascade)
    vitalReading         VitalReading?    @relation(fields: [vitalReadingId], references: [id], onDelete: SetNull)
    medicalDevice        MedicalDevice?   @relation(fields: [medicalDeviceId], references: [id], onDelete: SetNull)
    emergencyAlerts      EmergencyAlert[] @relation("DeviceReadingToEmergencyAlert")
    @@index([patientId, readingType, measurementTimestamp])
    @@index([deviceId, measurementTimestamp])
    @@index([pluginId, readingType])
    @@index([triggeredAlerts, measurementTimestamp])
    @@map("deviceReadings")
}

model DevicePlugin {
    id               String       @id @db.VarChar(100)
    name             String       @db.VarChar(255)
    version          String       @db.VarChar(20)
    description      String?      @db.Text
    supportedDevices DeviceType[]
    supportedRegions String[]     @default([])
    apiVersion       String       @db.VarChar(10)
    defaultConfig    Json         @default("{}")
    oauthConfig      Json?        @default("{}")
    rateLimits       Json?        @default("{}")
    isEnabled        Boolean      @default(true)
    requiresAuth     Boolean      @default(false)
    maintenanceMode  Boolean      @default(false)
    installedAt      DateTime     @default(now())
    lastUpdated      DateTime     @updatedAt
    usageCount       Int          @default(0)
    @@map("devicePlugins")
}

model MedicalDevice {
    id                 String    @id @default(uuid()) @db.Uuid
    organizationId     String?   @db.Uuid
    patientId          String?   @db.Uuid
    deviceName         String    @db.VarChar(255)
    deviceType         String    @db.VarChar(100)
    manufacturer       String    @db.VarChar(100)
    modelNumber        String?   @db.VarChar(100)
    serialNumber       String?   @db.VarChar(100)
    firmwareVersion    String?   @db.VarChar(50)
    macAddress         String?   @db.VarChar(20)
    ipAddress          String?   @db.VarChar(20)
    bluetoothId        String?   @db.VarChar(50)
    status             String    @default("inactive") @db.VarChar(20) // active, inactive, maintenance, error
    lastConnected      DateTime?
    lastDataSync       DateTime?
    batteryLevel       Int? // 0-100 percentage
    connectionType     String    @db.VarChar(30) // bluetooth, wifi, cellular, usb, serial
    dataFrequency      String?   @db.VarChar(50) // continuous, daily, weekly, on-demand
    calibrationDate    DateTime?
    nextCalibrationDue DateTime?
    isActive           Boolean   @default(true)
    configuration      Json      @default("{}")
    metadata           Json      @default("{}")
    createdAt          DateTime  @default(now())
    updatedAt          DateTime  @updatedAt
    deletedAt          DateTime?
    organization   Organization?   @relation(fields: [organizationId], references: [id])
    patient        Patient?        @relation(fields: [patientId], references: [id])
    deviceReadings DeviceReading[]
    @@index([patientId])
    @@index([deviceType])
    @@index([status])
    @@index([organizationId])
    @@map("medicalDevices")
}

model AdherenceLog {
    id             String  @id @default(uuid()) @db.Uuid
    patientId      String  @db.Uuid
    organizationId String? @db.Uuid
    adherenceType String @db.VarChar(30) // medication, appointment, vital_check, care_plan_task, etc.
    relatedMedicationId    String? @db.Uuid
    relatedPrescriptionId  String? @db.Uuid
    relatedAppointmentId   String? @db.Uuid
    relatedCarePlanId      String? @db.Uuid
    relatedTreatmentPlanId String? @db.Uuid
    scheduledDatetime DateTime
    actualDatetime    DateTime?
    status               String @db.VarChar(20) // completed, missed, partial, delayed, rescheduled, cancelled
    completionPercentage Int    @default(0) // 0-100
    delayMinutes         Int? // negative for early, positive for late
    prescribedDose Decimal? @db.Decimal(10, 3)
    actualDose     Decimal? @db.Decimal(10, 3)
    doseUnit       String?  @db.VarChar(20)
    patientNotes        String? @db.Text
    sideEffectsReported Json    @default("[]")
    symptomsBefore      Json    @default("{}")
    symptomsAfter       Json    @default("{}")
    missedReason        String? @db.VarChar(50) // forgot, side_effects, cost_concerns, etc.
    missedReasonDetails String? @db.Text
    recordedBy       String  @default("patient") @db.VarChar(20) // patient, caregiver, provider, system, device
    recordedByUserId String? @db.Uuid
    deviceId           String? @db.Uuid
    verificationMethod String? @db.VarChar(30) // self_report, caregiver_report, pill_count, smart_bottle, etc.
    moodBefore Int? // 1-10 scale
    moodAfter  Int? // 1-10 scale
    location   String? @db.VarChar(100)
    reminderSent          Boolean @default(false)
    reminderAcknowledged  Boolean @default(false)
    interventionTriggered Boolean @default(false)
    metadata  Json      @default("{}")
    createdAt DateTime  @default(now())
    updatedAt DateTime  @updatedAt
    deletedAt DateTime?
    patient              Patient        @relation(fields: [patientId], references: [id], onDelete: Cascade)
    organization         Organization?  @relation(fields: [organizationId], references: [id])
    relatedMedication    Medication?    @relation(fields: [relatedMedicationId], references: [id])
    relatedPrescription  Prescription?  @relation(fields: [relatedPrescriptionId], references: [id])
    relatedAppointment   Appointment?   @relation(fields: [relatedAppointmentId], references: [id])
    relatedCarePlan      CarePlan?      @relation(fields: [relatedCarePlanId], references: [id])
    relatedTreatmentPlan TreatmentPlan? @relation(fields: [relatedTreatmentPlanId], references: [id])
    recordedByUser       User?          @relation(fields: [recordedByUserId], references: [id])
    @@index([patientId])
    @@index([organizationId])
    @@index([adherenceType])
    @@index([status])
    @@index([scheduledDatetime])
    @@index([actualDatetime])
    @@index([relatedMedicationId])
    @@index([relatedCarePlanId])
    @@index([patientId, adherenceType, scheduledDatetime])
    @@index([relatedMedicationId, status, scheduledDatetime])
    @@index([patientId, status, createdAt])
    @@map("adherenceLogs")
}

model BlacklistedToken {
    jti       String   @id @db.VarChar(255)
    expiresAt DateTime
    createdAt DateTime @default(now())
    @@index([expiresAt])
    @@map("blacklistedTokens")
}

model SymptomAssessment {
    id                   String             @id @default(uuid()) @db.Uuid
    patientId            String             @db.Uuid
    doctorId             String             @db.Uuid
    assessmentDate       DateTime           @default(now())
    chiefComplaint       String?            @db.Text
    presentIllnessHistory String?           @db.Text
    symptoms             Json               @default("[]") // Array of symptom objects
    physicalFindings     Json               @default("{}")
    vitalSigns           Json               @default("{}")
    reviewOfSystems      Json               @default("{}")
    status               String             @default("IN_PROGRESS") @db.VarChar(20) // IN_PROGRESS, COMPLETED, PENDING_REVIEW
    priority             String             @default("ROUTINE") @db.VarChar(20) // ROUTINE, URGENT, EMERGENCY
    notes                String?            @db.Text
    createdAt            DateTime           @default(now())
    updatedAt            DateTime           @updatedAt
    deletedAt            DateTime?
    patient              Patient            @relation(fields: [patientId], references: [id], onDelete: Cascade)
    doctor               Doctor             @relation(fields: [doctorId], references: [id])
    clinicalDiagnoses    ClinicalDiagnosis[]
    @@index([patientId])
    @@index([doctorId])
    @@index([assessmentDate])
    @@index([status])
    @@map("symptomAssessments")
}

model ClinicalDiagnosis {
    id                        String             @id @default(uuid()) @db.Uuid
    assessmentId              String?            @db.Uuid
    patientId                 String             @db.Uuid
    doctorId                  String             @db.Uuid
    primaryDiagnosis          String?            @db.VarChar(500)
    secondaryDiagnoses        Json               @default("[]") // Array of diagnosis strings
    icd10Codes                Json               @default("[]") // Array of ICD-10 codes
    clinicalFindings          Json               @default("{}")
    diagnosticTests           Json               @default("[]") // Array of test objects
    diagnosisSuggestions      Json               @default("[]") // Array of AI/system generated suggestions
    treatmentRecommendations  Json               @default("[]") // Array of treatment options
    drugInteractions          Json               @default("[]") // Array of drug interaction warnings
    confidenceScore           Decimal?           @db.Decimal(3, 2) // 0.00 to 1.00
    status                    String             @default("PENDING_REVIEW") @db.VarChar(20) // DRAFT, PENDING_REVIEW, CONFIRMED, REVISED
    reviewedAt                DateTime?
    reviewedBy                String?            @db.Uuid
    clinicalNotes             String?            @db.Text
    followUpRequired          Boolean            @default(false)
    followUpDate              DateTime?
    severity                  String?            @default("MODERATE") @db.VarChar(20) // MILD, MODERATE, SEVERE, CRITICAL
    isActive                  Boolean            @default(true)
    createdAt                 DateTime           @default(now())
    updatedAt                 DateTime           @updatedAt
    deletedAt                 DateTime?
    patient                   Patient            @relation(fields: [patientId], references: [id], onDelete: Cascade)
    doctor                    Doctor             @relation(fields: [doctorId], references: [id])
    reviewedByUser            User?              @relation(fields: [reviewedBy], references: [id])
    symptomAssessment         SymptomAssessment? @relation(fields: [assessmentId], references: [id])
    @@index([patientId])
    @@index([doctorId])
    @@index([status])
    @@index([createdAt])
    @@index([isActive])
    @@index([followUpRequired, followUpDate])
    @@map("clinicalDiagnoses")
}
